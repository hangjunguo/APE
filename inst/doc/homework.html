<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Hangjun Guo" />

<meta name="date" content="2021-12-20" />

<title>StatComp21003 homework</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">StatComp21003 homework</h1>
<h4 class="author">Hangjun Guo</h4>
<h4 class="date">2021-12-20</h4>



<div id="a-21003-2021-09-23" class="section level2">
<h2>A-21003-2021-09-23</h2>
</div>
<div id="question" class="section level2">
<h2>Question</h2>
<p>Exercises 3.4, 3.11, and 3.20 (pages 94-96, Statistical Computing with R).</p>
</div>
<div id="answer" class="section level2">
<h2>Answer</h2>
<p><strong>3.4</strong></p>
<p>算法原理：注意到若<span class="math inline">\(Y \sim \operatorname{Exp}(1)\)</span>，令<span class="math inline">\(X = \sqrt{2 \sigma^2 Y}\)</span>，则随机变量<span class="math inline">\(X\)</span>的密度函数为 <span class="math display">\[
f(x)=\left(\frac{x^2}{2 \sigma^{2}}\right)^{&#39;} e^{-x^{2} /\left(2 \sigma^{2}\right)}=
\frac{x}{\sigma^{2}} e^{-x^{2} /\left(2 \sigma^{2}\right)},
\]</span> 其中<span class="math inline">\(x \geq 0, \sigma&gt;0\)</span>，从而得到<span class="math inline">\(f(x)\)</span>为Rayleigh分布密度函数。因此可以通过指数随机变量<span class="math inline">\(Y\)</span>生成Rayleigh随机变量<span class="math inline">\(X\)</span>。 对不同参数<span class="math inline">\(\sigma=1, 2, 3, 4, 5\)</span>生成<span class="math inline">\(\operatorname{Rayleigh}(\sigma)\)</span>分布随机数的R代码如下所示：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)<span class="co">#加载knitr package</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#生成Rayleigh分布随机数</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>rrayleigh <span class="ot">=</span> <span class="cf">function</span> (size, sigma) {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sigma <span class="sc">&gt;</span> <span class="dv">0</span>)<span class="co">#参数sigma&gt;0</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span>  <span class="fu">runif</span>(size)<span class="co">#均匀分布随机数</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(u))<span class="co">#通过指数随机数生成Rayleigh随机数，其中-log(u)为指数随机数</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Rayleigh分布密度函数</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>drayleigh <span class="ot">=</span> <span class="cf">function</span> (x, sigma) {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(sigma <span class="sc">&gt;</span> <span class="dv">0</span>)<span class="co">#参数sigma&gt;0</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span>  x <span class="sc">/</span> (sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>))<span class="co">#Rayleigh分布密度函数</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  y[x <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span>  <span class="dv">0</span><span class="co">#x&lt;0时密度为0</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#对不同的sigma=1, 2, 3, 4, 5分别生成Rayleigh随机数</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="dv">1500</span><span class="co">#样本量</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)<span class="co">#参数sigma取值</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sigmas, <span class="cf">function</span>(x) <span class="fu">rrayleigh</span>(size, x))<span class="co">#利用sapply对不同sigma生成Rayleigh随机数</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(samples)<span class="co">#转为数据框</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(samples)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;sigma =&quot;</span>, sigmas)<span class="co">#重命名各列</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(samples), <span class="at">caption =</span> <span class="st">&quot;表1.1：sigma=1, 2, 3, 4, 5时生成的Rayleigh随机数&quot;</span>)<span class="co">#绘制数据样本表格</span></span></code></pre></div>
<table>
<caption>表1.1：sigma=1, 2, 3, 4, 5时生成的Rayleigh随机数</caption>
<thead>
<tr class="header">
<th align="right">sigma = 1</th>
<th align="right">sigma = 2</th>
<th align="right">sigma = 3</th>
<th align="right">sigma = 4</th>
<th align="right">sigma = 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.2455407</td>
<td align="right">4.527686</td>
<td align="right">4.323562</td>
<td align="right">2.067590</td>
<td align="right">5.5158294</td>
</tr>
<tr class="even">
<td align="right">2.0534550</td>
<td align="right">4.122368</td>
<td align="right">3.616558</td>
<td align="right">5.920237</td>
<td align="right">6.3764597</td>
</tr>
<tr class="odd">
<td align="right">0.5504207</td>
<td align="right">2.283062</td>
<td align="right">5.324225</td>
<td align="right">1.836361</td>
<td align="right">9.4693169</td>
</tr>
<tr class="even">
<td align="right">0.9339269</td>
<td align="right">3.209739</td>
<td align="right">4.116779</td>
<td align="right">5.522364</td>
<td align="right">0.3774525</td>
</tr>
<tr class="odd">
<td align="right">0.3006245</td>
<td align="right">5.077264</td>
<td align="right">4.099802</td>
<td align="right">8.576545</td>
<td align="right">3.9060723</td>
</tr>
<tr class="even">
<td align="right">0.7128284</td>
<td align="right">4.015494</td>
<td align="right">7.322059</td>
<td align="right">3.710527</td>
<td align="right">8.1596671</td>
</tr>
</tbody>
</table>
<p>对<span class="math inline">\(\sigma=1\)</span>通过直方图验证生成的随机数近似于理论分布。</p>
<p>可以看到，样本量<span class="math inline">\(n\)</span>很大时，样本直方图与精确概率密度曲线将非常接近。</p>
<p><strong>3.11</strong></p>
<p>首先生成1000个由两个正态随机变量<span class="math inline">\(X_1 \sim N(0, 1)\)</span>和<span class="math inline">\(X_2 \sim N(3, 1)\)</span>组成的复合分布随机数<span class="math inline">\(X\)</span>。算法原理为先生成随机数<span class="math inline">\(X_1\)</span>和<span class="math inline">\(X_2\)</span>，则以概率<span class="math inline">\(p_1\)</span>取值<span class="math inline">\(X_1\)</span>，以概率<span class="math inline">\(p_2\)</span>取值<span class="math inline">\(X_2\)</span>即可得到复合分布随机数<span class="math inline">\(X\)</span>。R代码如下所示：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#生成复合分布随机数</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rmix <span class="ot">=</span> <span class="cf">function</span>(size, p){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(size, <span class="dv">0</span>, <span class="dv">1</span>)<span class="co">#生成x1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(size, <span class="dv">3</span>, <span class="dv">1</span>)<span class="co">#生成x2</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(size)<span class="co">#生成均匀分布随机数</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(u<span class="sc">&lt;</span>p)<span class="co">#t以概率p取1，以概率1-p取0</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> t<span class="sc">*</span>x1 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>t)<span class="sc">*</span>x2<span class="co">#生成复合分布随机数x</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span><span class="co">#样本量1000</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fl">0.75</span><span class="co">#p1取0.75</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rmix</span>(n, p1)<span class="co">#生成1000个复合分布随机数</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制直方图和密度曲线</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">freq =</span> F, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(x), <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAUVBMVEUAAAAAADoAAGYAOpAAZrY6AAA6ADo6OpA6kNtmAABmtv+QOgCQZgCQ2/+2ZgC2/7a2///T09PbkDrb2//b////AAD/tmb/25D//7b//9v///97yrZnAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAHDElEQVR4nO3d63raOBSFYadtOqWZ0sGtzOH+L3TwiWBjaUnWlrYR6/tT2owPvI8CxpaH6sKcVdo7sPUIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQKAzo/FF1ffkv0e5sryCguvrRP2jGB+UXAnT+uLHUX/8m2JktFgJ02v0cHzYv80vGEQQKfA0ahhBfgyyddv272MuMHx4HwQgEWgHUVNXbL/k92WhhQPuq+nH85+/9G37pBQHtry/O+2708G1+qW7cHL+3QDxQXOq0a49+zn8uHEGW6nHc9FR3a7kltmNbKewZ1f3bV1PZXqNfHSj36jYQgUArn1FteRcjUPrVmbb41Ui1OaAOZ0NCWwMaaLYjJHxVIx5o9qd6wlc1YoHMwiPdhM9JRwKZ5wbyuKoRC2R5rNimRpCx/kUv4asagkAbERK+qrEKaDwTYKanBJ4RKM3qqkOfGf6ce6l+ftkQkLkBzcFk9zFw5zawumrqUSJQ3BlFK5ApBihuddXU5wZ0INCwEIHAQgQCC019PoGGfyQQgcBCBAILTX3ugPp/JhCBwEIEAgvZgbp/J9DUh0APCxEILOQAan9CoKkPgR4WIhBYyAV0/VkBQLEnzIoHiltdNfUh0MNCTqCDeRqgfm5rIz67oyyg7qKz9VaEFEAH1SuIoUADjei1+ZnPcwMd3zsg0dkdCKjSFHqGEfREQO2RzrfL460Iq1Z3CwMpCgU+o6vR2y/HPb1rgMwDyPzvmhM9NnAcRCCQB5CikD6QuRDImReQnlD4u5hzKvlrA13OH+hW1WRAakKhtyJ8k1xdm7mUBGS7GTPihJkvkJaQ+os0gUDeQEpC2kDtsy4RSOye1QAgHaGnGEGzqfeyuwxSBuoGBQQaH2hMOHsuIIXpQqEHisL3rIYBacynCtqa/D2rgUAKs2FCtiZ/x2H/vhQClH0uQ9ineel7VoOB8k/2eLIRlP9SfeBrkOw9q8ORXxhQ5ivRYVsTvmd1DdAh8zUg1eOgVUCZhVSA5nfthgFVWf/XJyozzGb3YAYD5RTSGUFxQN3oM593jc9TeEbCq4sEGv40kyYjLPszEl7d7B7MlUDTv38aEcjy4zR3kesBGWmgcY3FAPmCeAMlOR1SFlCC0yFqQIs38UYDyX/aLw5I+tN+aUDi8861gGz3qAoAyX4MKQ9IWEgJyH4LZjyQ7LTqEoFEr1HrALluoJMAEhQqEkhSSOWEmUkNJPhLpjKCwP1hAkByQhpAJgOQmJDG5IX5vQdpgISEFCYvmCxAUkIKl54fZo6nARISyj954XFaqzTQbcqeEbjIkX8EpQe6PTIC58+yT15YmLWZDEhiOlHuyQsmK5DA+bPMx0Fmac5dQqD42TJ5gczijKmUQIfYLwrKeqBolue7JAWKvak8y4Hi9G33Yb5LYqBL1CDK8jbf77L1UmpqoEsMUZYDxWrCkxtoHL7rbvXIMYJm01NyA40Phr1ICGQ/ULw7ul/KOtUpd3f7lASI3zfPHiIQaCWQ7ZbM8koygnRfiVFbAIr7edyPYxeP+89lVlouEPyw6rfSYoHwh1W/lZYK5PFRw2+lpQJ5fFj1W2mpQBxBKHxVw2+lxQL5flh9XaAXjEAgAoEIBCIQiEAgAoEIBCIQiEAgAoEIBCIQKBXQ3vGBvzuzbTtf0lTtF1OsWtRj08f3/otB/EsE1DjOiJw/rgK1ZT+b9ms7rELORT023Vx/dNoFCaUBOu0ce9l/PdDytdn+pOXe9hRci3psul972FXhNED113/RBJDlYeIhYFvUY9PH744FLSUBuu6I64Wga7+I0D8F9yUBy6Iem26+/N7Bl7BZKYDakYyALGe1+8HhHCLOE+LuTdftFU/4xQXTUgC1lzwAUON4jQZAtkU9Nl2/eYzPWQmAul8TN5B1EOBfMecFFbDp/rVt+A45z2SB6vYopR6mmSzsRt0fxdTWJwlfpO2Ljuu3bLqthw97qdY4UKxtTwC+zbsW9dh0f2lY/VesywF0fHcMAveBonNRj023L1F314d9UgAafg8sCrXro4Z7Ubzp7kti9d/mi4pAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKBCAQiEIhAIAKB/gcZUZ/HXOARjQAAAABJRU5ErkJggg==" alt />
<p class="caption">图2.1：p1=0.75时复合分布的样本直方图和密度曲线</p>
</div>
<p>由图2.1可以看到，当<span class="math inline">\(p_1=0.75\)</span>时上述复合分布的经验密度曲线略有双峰性，在<span class="math inline">\(x=0\)</span>附近峰度较大，在<span class="math inline">\(x=3\)</span>附近峰度较小。</p>
<p>接下来改变多组<span class="math inline">\(p_1\)</span>取值，探究密度曲线双峰性的改变情况。下取<span class="math inline">\(p_1={0.1, 0.2, ..., 0.9}\)</span>进行重复试验。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow = c(3,3))#以下生成3*3图形矩阵</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for(p1 in seq(0.1, 0.9, 0.1)){</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- rmix(n, p1)#对不同p1生成复合分布随机数</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   #绘制直方图和密度曲线</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   hist(x, freq = F, xlim=c(-6, 6), ylim=c(0, 0.4), main=paste(&quot;p1 = &quot;, p1), xlab=&quot;&quot;, ylab=&quot;&quot;)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   lines(density(x), col=&quot;red&quot;)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
<p>由图2.2可以看到，当<span class="math inline">\(p_1\)</span>取值在<span class="math inline">\(0.5\)</span>附近时上述复合分布的经验密度曲线双峰性最强，而<span class="math inline">\(p_1\)</span>取值接近<span class="math inline">\(0\)</span>或<span class="math inline">\(1\)</span>时双峰性均逐渐消失。由此可以推测当<span class="math inline">\(0&lt;p_1&lt;1\)</span>时上述复合分布密度曲线具有双峰性，且当<span class="math inline">\(p_1=0.5\)</span>时密度曲线双峰性最强，<span class="math inline">\(p_1\)</span>取值接近<span class="math inline">\(0\)</span>或<span class="math inline">\(1\)</span>时双峰性逐渐减弱；且当<span class="math inline">\(p_1=0\)</span>或<span class="math inline">\(1\)</span>时上述复合分布密度曲线无双峰性，此时复合分布退化为正态分布<span class="math inline">\(N(3, 1)\)</span>或<span class="math inline">\(N(0, 1)\)</span>。</p>
<p><strong>3.20</strong></p>
<p>由题意知，复合泊松过程<span class="math inline">\(X(t)=\sum_{i=1}^{N(t)} Y_{i}, t \geq 0\)</span>，其中<span class="math inline">\(\{N(t), t \geq 0\}\)</span>是参数为<span class="math inline">\(\lambda\)</span>的泊松过程，<span class="math inline">\(Y_1, Y_2, ...\)</span>独立同分布并且与<span class="math inline">\(\{N(t), t \geq 0\}\)</span>相互独立。当<span class="math inline">\(Y\)</span>服从伽玛分布时，<span class="math inline">\(X(t)\)</span>为复合泊松-伽玛过程。模拟该过程的具体R代码如下所示：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#泊松过程参数lambda, t；Gamma分布参数shape, scale</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#生成复合泊松-伽玛过程的算法</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>PoiGammaProc <span class="ot">=</span> <span class="cf">function</span>(lambda, t, shape, scale){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  Tn <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1000</span>, lambda)<span class="co">#不知道需要多少Tn，因此生成充分多的Tn。Tn为泊松过程的间隔时间服从指数分布</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  Sn <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(Tn)<span class="co">#计算泊松过程到达时间</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">which</span>(Sn <span class="sc">&gt;</span> t)) <span class="sc">-</span> <span class="dv">1</span><span class="co">#[0, t]内的到达次数即为泊松过程随机数</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, <span class="at">shape =</span> shape, <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>scale)<span class="co">#生成N(t)个iid伽玛随机数Gamma(shape, scale)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">sum</span>(Y)<span class="co">#对N(t)个iid伽玛随机数求和，得到复合泊松-伽玛过程随机数</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>下面选择不同参数分别生成复合泊松-伽玛过程<span class="math inline">\(X(10)\)</span>，计算所生成样本的期望和方差，并与理论值进行对比。</p>
<ul>
<li>参数选择：取伽玛随机变量<span class="math inline">\(Y \sim \operatorname{Gamma}(\alpha, \beta)\)</span>的形状参数<span class="math inline">\(\alpha=4\)</span>和尺度参数<span class="math inline">\(\beta=2\)</span>，变化泊松过程强度参数<span class="math inline">\(\lambda={1, 2, 3}\)</span>。</li>
<li>复合泊松-伽玛过程<span class="math inline">\(X(t)=\sum_{i=1}^{N(t)} Y_{i}\)</span>的期望<span class="math inline">\(E[X(t)]=\lambda t E[Y_{1}]\)</span>，方差<span class="math inline">\(Var[X(t)]=\lambda t E[Y_{1}^{2}]\)</span>。证明如下： 令<span class="math inline">\(E[Y_1]=\mu\)</span>， <span class="math inline">\(Var(Y_1)=\sigma^2\)</span>，通过对<span class="math inline">\(N(t)\)</span>取条件期望可以得到， <span class="math display">\[
E[X(t)]=E[E[\sum_{i=1}^{n} Y_{i} \mid N(t)=n]]=E[N(t) \mu]=\lambda t \cdot \mu=\lambda t E\left[Y_{1}\right]
\]</span> <span class="math display">\[
\begin{aligned}
\operatorname{Var}[X(t)] &amp;=\operatorname{Var}\left[E\left[\sum_{i=1}^{n} Y_{i} \mid N(t)=n\right]\right]+E\left[\operatorname{Var}\left[\sum_{i=1}^{n} Y_{i} \mid N(t)=n\right]\right] \\
&amp;=\operatorname{Var}[N(t) \mu]+E\left[N(t)\sigma^2\right]=\mu^{2} \operatorname{Var}[N(t)]+\sigma^2 E[N(t)] \\
&amp;=\mu^{2} \lambda t+\sigma^2 \lambda t=\lambda t E\left[Y_{1}^{2}\right]
\end{aligned}
\]</span></li>
</ul>
<p>代入伽玛分布期望和方差进一步可得，<span class="math inline">\(E[X(t)]= \frac{\lambda t\alpha}{\beta}\)</span>，<span class="math inline">\(Var[X(t)]=\frac{\lambda t(\alpha^2+\alpha)}{\beta^2}\)</span>。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">10</span><span class="co">#取t=10</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)<span class="co">#变化泊松过程强度参数lambda=1,2,3</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>shape <span class="ot">&lt;-</span> <span class="dv">4</span><span class="co">#伽玛分布形状参数取4</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="dv">2</span><span class="co">#伽玛分布尺度参数取2</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="dv">1000</span><span class="co">#样本量为1000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#对不同参数lambda分别生成复合泊松-伽玛过程</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>Xt1 <span class="ot">&lt;-</span> <span class="fu">replicate</span>(size, <span class="fu">PoiGammaProc</span>(lambda[<span class="dv">1</span>], t, shape, scale))<span class="co">#lambda=1</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>Xt2 <span class="ot">&lt;-</span> <span class="fu">replicate</span>(size, <span class="fu">PoiGammaProc</span>(lambda[<span class="dv">2</span>], t, shape, scale))<span class="co">#lambda=2</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>Xt3 <span class="ot">&lt;-</span> <span class="fu">replicate</span>(size, <span class="fu">PoiGammaProc</span>(lambda[<span class="dv">3</span>], t, shape, scale))<span class="co">#lambda=3</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Xt1, Xt2, Xt3)<span class="co">#将三组样本合并为样本矩阵</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#均值的对比</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>mean.s <span class="ot">&lt;-</span> <span class="fu">apply</span>(mat, <span class="dv">2</span>, mean, <span class="at">trim=</span>.<span class="dv">5</span>)<span class="co">#利用apply函数计算模拟样本均值</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>mean.th <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lambda, <span class="cf">function</span>(x){</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">*</span>t<span class="sc">*</span>shape<span class="sc">/</span>scale</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>})<span class="co">#计算理论复合泊松-伽玛过程的均值</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>mean.mat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mean.s, mean.th)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mean.mat, <span class="at">caption =</span> <span class="st">&quot;表3.1：复合泊松-伽玛过程模拟样本均值和理论均值对比，变化泊松过程强度参数lambda=1, 2, 3&quot;</span>)</span></code></pre></div>
<table>
<caption>表3.1：复合泊松-伽玛过程模拟样本均值和理论均值对比，变化泊松过程强度参数lambda=1, 2, 3</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Xt1</th>
<th align="right">Xt2</th>
<th align="right">Xt3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mean.s</td>
<td align="right">19.6975</td>
<td align="right">39.61647</td>
<td align="right">59.52406</td>
</tr>
<tr class="even">
<td align="left">mean.th</td>
<td align="right">20.0000</td>
<td align="right">40.00000</td>
<td align="right">60.00000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#方差的对比</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>var.s <span class="ot">&lt;-</span> (<span class="dv">1-1</span><span class="sc">/</span>size)<span class="sc">*</span><span class="fu">apply</span>(mat, <span class="dv">2</span>, var)<span class="co">#利用apply函数计算模拟样本方差</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>var.th <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lambda, <span class="cf">function</span>(x){</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">*</span>t<span class="sc">*</span>(shape<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>shape)<span class="sc">/</span>scale<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>})<span class="co">#计算理论复合泊松-伽玛过程的方差</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>var.mat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(var.s, var.th)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(var.mat, <span class="at">caption =</span> <span class="st">&quot;表3.2：复合泊松-伽玛过程模拟样本方差和理论方差对比，变化泊松过程强度参数lambda=1, 2, 3&quot;</span>)</span></code></pre></div>
<table>
<caption>表3.2：复合泊松-伽玛过程模拟样本方差和理论方差对比，变化泊松过程强度参数lambda=1, 2, 3</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Xt1</th>
<th align="right">Xt2</th>
<th align="right">Xt3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">var.s</td>
<td align="right">50.22742</td>
<td align="right">103.1684</td>
<td align="right">147.1926</td>
</tr>
<tr class="even">
<td align="left">var.th</td>
<td align="right">50.00000</td>
<td align="right">100.0000</td>
<td align="right">150.0000</td>
</tr>
</tbody>
</table>
<p>由表3.1和表3.2可以看到，通过上述方法模拟得到的复合泊松-伽玛过程<span class="math inline">\(X(10)\)</span>的均值和方差，都与理论计算得到的均值和方差非常接近，从而验证了利用上述算法生成复合泊松-伽玛过程的有效性。</p>
</div>
<div id="a-21003-2021-09-30" class="section level2">
<h2>A-21003-2021-09-30</h2>
</div>
<div id="question-1" class="section level2">
<h2>Question</h2>
<p>Exercises 5.4, 5.9, 5.13 and 5.14 (pages 149-151, Statistical Computing with R).</p>
</div>
<div id="answer-1" class="section level2">
<h2>Answer</h2>
<p><strong>5.4</strong></p>
<p>算法原理：注意到若随机变量<span class="math inline">\(X \sim \operatorname{Beta}(3, 3)\)</span>，则<span class="math inline">\(X\)</span>的分布函数(cdf)为<span class="math inline">\(F(x)=\int_{0}^{x} 30 t^{2}(1-t)^{2} \mathrm{~d} t\)</span>。利用Monte Carlo方法近似计算这一分布函数的R代码如下所示</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#利用MC方法近似计算Beta分布函数</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>cdfBeta <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">alpha=</span><span class="dv">3</span>, <span class="at">beta=</span><span class="dv">3</span>, <span class="at">n=</span><span class="dv">10000</span>){ <span class="co">#x为需计算的点，alpha, beta为Beta分布参数，n为MC方法模拟次数</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(x<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;&amp;</span> x<span class="sc">&lt;</span><span class="dv">1</span>)<span class="co">#排除定义域(0, 1)外的取值</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, x)<span class="co">#10000个[0,x]上的均匀分布随机数</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span><span class="fu">beta</span>(alpha, beta)) <span class="sc">*</span> u<span class="sc">^</span>(alpha<span class="dv">-1</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>u)<span class="sc">^</span>(beta<span class="dv">-1</span>)<span class="co">#计算g(x)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  cdf <span class="ot">&lt;-</span> (x<span class="dv">-0</span>) <span class="sc">*</span> <span class="fu">mean</span>(g)<span class="co">#求均值得到cdf</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">min</span>(<span class="dv">1</span>, cdf))<span class="co">#返回cdf取值，由于cdf函数值不超过1，所以如果模拟结果大于1则取cdf为1</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br />
下面利用上述R function估计分布函数<span class="math inline">\(F(x)\)</span>，其中<span class="math inline">\(x=0.1, 0.2, ..., 0.9\)</span>，并将Monte Carlo方法的模拟结果与R内置函数<code>pbeta</code>返回的结果进行对比。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">504</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>)<span class="co">#生成x=0.1, ..., 0.9</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>cdf_MC <span class="ot">&lt;-</span> <span class="fu">sapply</span>(x, <span class="cf">function</span>(z) <span class="fu">cdfBeta</span>(z))<span class="co">#利用sapply对每个x利用MC方法计算对应的cdf</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>cdf_pbeta <span class="ot">&lt;-</span> <span class="fu">pbeta</span>(x, <span class="dv">3</span>, <span class="dv">3</span>)<span class="co">#利用R内置函数pbeta计算cdf</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x, cdf_MC, cdf_pbeta)<span class="co">#合并计算结果</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(result)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;Monte Carlo&quot;</span>, <span class="st">&quot;pbeta&quot;</span>)<span class="co">#重命名各列</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result, <span class="at">caption =</span> <span class="st">&quot;表1.1：Monte Carlo方法与R内置函数pbeta分别计算Beta(3, 3)分布函数的结果对比&quot;</span>)<span class="co">#利用kable绘制计算结果表格</span></span></code></pre></div>
<table>
<caption>表1.1：Monte Carlo方法与R内置函数pbeta分别计算Beta(3, 3)分布函数的结果对比</caption>
<thead>
<tr class="header">
<th align="right">x</th>
<th align="right">Monte Carlo</th>
<th align="right">pbeta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.1</td>
<td align="right">0.0085125</td>
<td align="right">0.00856</td>
</tr>
<tr class="even">
<td align="right">0.2</td>
<td align="right">0.0582217</td>
<td align="right">0.05792</td>
</tr>
<tr class="odd">
<td align="right">0.3</td>
<td align="right">0.1637396</td>
<td align="right">0.16308</td>
</tr>
<tr class="even">
<td align="right">0.4</td>
<td align="right">0.3174760</td>
<td align="right">0.31744</td>
</tr>
<tr class="odd">
<td align="right">0.5</td>
<td align="right">0.5001302</td>
<td align="right">0.50000</td>
</tr>
<tr class="even">
<td align="right">0.6</td>
<td align="right">0.6851954</td>
<td align="right">0.68256</td>
</tr>
<tr class="odd">
<td align="right">0.7</td>
<td align="right">0.8384041</td>
<td align="right">0.83692</td>
</tr>
<tr class="even">
<td align="right">0.8</td>
<td align="right">0.9398878</td>
<td align="right">0.94208</td>
</tr>
<tr class="odd">
<td align="right">0.9</td>
<td align="right">0.9820322</td>
<td align="right">0.99144</td>
</tr>
</tbody>
</table>
<p>从表1.1可以看到，Monte Carlo方法的估计结果与R内置函数<code>pbeta</code>返回的结果非常接近，从而验证了以上Monte Carlo方法近似计算<span class="math inline">\(X \sim \operatorname{Beta}(3, 3)\)</span>分布函数R代码的有效性。</p>
<p><br />
<strong>5.9</strong></p>
<p>算法原理：由题可得Rayleigh随机变量的分布函数为<span class="math inline">\(F(x)=\int_{0}^{x} \frac{t}{\sigma^{2}} e^{-t^{2} /\left(2 \sigma^{2}\right)} \mathrm{~d} t=1 - e^{-t^{2} /\left(2 \sigma^{2}\right)}\)</span>，利用逆变换法易得<span class="math inline">\(X = \sqrt{-2 \sigma^2 log(1-U)}= \sqrt{-2 \sigma^2 log(U)}\)</span>为Rayleigh随机变量，其中<span class="math inline">\(U \sim U[0,1]\)</span>。则通过对偶变量法生成<span class="math inline">\(\operatorname{Rayleigh}(\sigma)\)</span>分布随机数的R代码如下所示</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#对偶变量法生成Rayleigh分布随机数</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>rrayleigh <span class="ot">=</span> <span class="cf">function</span>(sigma, <span class="at">n=</span><span class="dv">10000</span>, <span class="at">antithetic=</span><span class="cn">TRUE</span>){<span class="co">#sigma为Rayleigh分布参数，n模拟次数，antithetic是否应用对偶变量，默认为是</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)<span class="co">#生成n/2个均匀随机数</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>antithetic) v <span class="ot">&lt;-</span> <span class="fu">runif</span>(n) <span class="cf">else</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>u<span class="co">#若应用对偶变量，则令后一半均匀随机数v为1-u，否则v为n个均匀随机数且与u独立</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(u))<span class="co">#利用u生成一组Rayleigh分布随机数X1</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  X2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(v))<span class="co">#利用v生成一组Rayleigh分布随机数X2</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> (X1<span class="sc">+</span>X2)<span class="sc">/</span><span class="dv">2</span><span class="co">#取两组样本均值得到最终估计</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br />
下面分别取不同参数<span class="math inline">\(\sigma=1,2,3,4,5\)</span>生成Rayleigh分布随机数，并计算对偶变量法生成的随机数（<span class="math inline">\(\frac{X+X&#39;}{2}\)</span>，<span class="math inline">\(X\)</span>与<span class="math inline">\(X&#39;\)</span>负相关）方差相比简单方法生成的随机数（<span class="math inline">\(\frac{X_1+X_2}{2}\)</span>，<span class="math inline">\(X_1\)</span>与<span class="math inline">\(X_2\)</span>相互独立）方差减少的比例。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)<span class="co">#初始化参数sigma</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>var_reduction <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="fu">length</span>(sigmas))<span class="co">#存储结果矩阵</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">509</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sigmas)){</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  simple <span class="ot">&lt;-</span> <span class="fu">rrayleigh</span>(sigmas[i], <span class="at">antithetic =</span> <span class="cn">FALSE</span>)<span class="co">#利用简单方法生成Rayleigh分布随机数，X1与X2独立</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  antithetic <span class="ot">&lt;-</span> <span class="fu">rrayleigh</span>(sigmas[i])<span class="co">#利用对偶变量生成Rayleigh分布随机数，X1与X2负相关</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  var_reduction[<span class="dv">1</span>, i] <span class="ot">&lt;-</span> (<span class="fu">var</span>(simple)<span class="sc">-</span><span class="fu">var</span>(antithetic))<span class="sc">/</span><span class="fu">var</span>(simple)<span class="co">#对偶变量法相比简单方法的方差减少比例</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(var_reduction)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;sigma =&quot;</span>, sigmas)<span class="co">#重命名各列</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(var_reduction, <span class="at">caption =</span> <span class="st">&quot;表2.1：对偶变量法生成Rayleigh随机数相比简单方法生成Rayleigh随机数方差减少的比例&quot;</span>)<span class="co">#绘制结果表格</span></span></code></pre></div>
<table>
<caption>表2.1：对偶变量法生成Rayleigh随机数相比简单方法生成Rayleigh随机数方差减少的比例</caption>
<thead>
<tr class="header">
<th align="right">sigma = 1</th>
<th align="right">sigma = 2</th>
<th align="right">sigma = 3</th>
<th align="right">sigma = 4</th>
<th align="right">sigma = 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9437146</td>
<td align="right">0.9431686</td>
<td align="right">0.9474353</td>
<td align="right">0.9492418</td>
<td align="right">0.94836</td>
</tr>
</tbody>
</table>
<p>从表2.1可以看到，对偶变量法（<span class="math inline">\(\frac{X+X&#39;}{2}\)</span>，<span class="math inline">\(X\)</span>与<span class="math inline">\(X&#39;\)</span>负相关）相比简单方法（<span class="math inline">\(\frac{X_1+X_2}{2}\)</span>，<span class="math inline">\(X_1\)</span>与<span class="math inline">\(X_2\)</span>相互独立）所生成估计的方差能够减少约95%，所以对偶变量法相对更优。</p>
<p><br />
<strong>5.13</strong></p>
<p>由题设被积函数<span class="math inline">\(g(x)=\frac{x^{2}}{\sqrt{2 \pi}} e^{-x^{2} / 2}, \quad x&gt;1\)</span>，可以选取两个接近于<span class="math inline">\(g(x)\)</span>的importance function分别为Pareto分布密度 <span class="math display">\[
f_{1}(x)=\frac{1}{x^2}, \quad x&gt;1
\]</span> 和 <span class="math display">\[
f_{2}(x)=e^{1-x}, \quad x&gt;1
\]</span> 显然<span class="math inline">\(f_1\)</span>和<span class="math inline">\(f_2\)</span>都在<span class="math inline">\((1,\infty)\)</span>具有支撑。<span class="math inline">\(\frac{g(x)}{f(x)}\)</span>越接近于常数，则利用importance sampling所生成估计的方差越小。为说明这点，下面生成<span class="math inline">\(\frac{g(x)}{f(x)}\)</span>的函数图像进行比较</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="cf">function</span> (x) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> (x<span class="sc">&gt;</span><span class="dv">1</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)<span class="co">#取点</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>y_g <span class="ot">&lt;-</span> <span class="fu">g</span>(x)<span class="co">#g(x)函数值</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>y_f1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> x<span class="sc">^</span><span class="dv">2</span><span class="co">#f1函数值</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>y_f2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="dv">1</span><span class="sc">-</span>x)<span class="co">#f2函数值</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制g/f的函数图像</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">c</span>(y_g<span class="sc">/</span>y_f1, y_g<span class="sc">/</span>y_f2))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>gs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(f[<span class="dv">1</span>](x)<span class="sc">==</span><span class="dv">1</span><span class="sc">/</span>x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expression</span>(f[<span class="dv">2</span>](x)<span class="sc">==</span>e<span class="sc">^</span>{<span class="dv">1</span><span class="sc">-</span>x}))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y_g<span class="sc">/</span>y_f1, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ylim), <span class="at">lwd =</span> w, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, y_g<span class="sc">/</span>y_f2, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> w,<span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> gs,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">lwd =</span> w, <span class="at">inset =</span> <span class="fl">0.02</span>,<span class="at">col=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">图3.1：g/f的函数图像</p>
</div>
<p>从图3.1可以看到，<span class="math inline">\(\frac{g(x)}{f_2(x)}\)</span>函数值波动幅度较小，即更加接近于常数，所以利用<span class="math inline">\(f_2(x)\)</span>的importance sampling所生成估计的方差将会更小。下面通过模拟计算进一步验证</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> se <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">2</span>)<span class="co">#存储估计值theta.hat和标准差se</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">513</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#importance function取f1，逆变换法</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>u)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>fg <span class="ot">&lt;-</span> <span class="fu">g</span>(x) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">/</span>x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>theta.hat[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(fg)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>se[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sd</span>(fg)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#importance function取f2，逆变换法</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">log</span>(u)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>fg <span class="ot">&lt;-</span> <span class="fu">g</span>(x) <span class="sc">/</span> <span class="fu">exp</span>(<span class="dv">1</span><span class="sc">-</span>x)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>theta.hat[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(fg)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>se[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sd</span>(fg)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cbind</span>(theta.hat, se)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(result)[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;f1&quot;</span>, <span class="st">&quot;f2&quot;</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result, <span class="at">caption =</span> <span class="st">&quot;表3.1：利用f1和f2的importance sampling所生成的估计和标准差对比&quot;</span>)<span class="co">#kable绘制结果表格</span></span></code></pre></div>
<table>
<caption>表3.1：利用f1和f2的importance sampling所生成的估计和标准差对比</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">theta.hat</th>
<th align="right">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">f1</td>
<td align="right">0.4089707</td>
<td align="right">0.3073441</td>
</tr>
<tr class="even">
<td align="left">f2</td>
<td align="right">0.3992673</td>
<td align="right">0.1591873</td>
</tr>
</tbody>
</table>
<p>从表3.1容易看到，两种方法估计结果theta.hat相近，但显然利用<span class="math inline">\(f_2(x)\)</span>的importance sampling所生成估计的方差更小。</p>
<p><br />
<strong>5.14</strong></p>
<p>令<span class="math inline">\(\theta=\int_{1}^{\infty} \frac{x^{2}}{\sqrt{2 \pi}} e^{-x^{2} / 2} d x\)</span>，<span class="math inline">\(g(x)=\frac{x^{2}}{\sqrt{2 \pi}} e^{-x^{2} / 2}\)</span>。为利用importance sampling得到<span class="math inline">\(\theta\)</span>的Monte Carlo估计，由题5.13中所述，这里选取较优的importance function <span class="math display">\[
f(x)=e^{1-x}, \quad x&gt;1
\]</span> 于是有 <span class="math display">\[\theta=\int_{1}^{\infty} \frac{x^{2}}{e\sqrt{2 \pi}} e^{x-x^{2} / 2} f(x) d x\]</span> 并且由逆变换法易得，该分布密度对应的随机变量可由<span class="math inline">\(X=1-log(U)\)</span>，其中<span class="math inline">\(U \sim U[0,1]\)</span>生成。则利用importance sampling进行估计的R代码如下所示</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>theta.hat <span class="ot">&lt;-</span> se <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1</span>)<span class="co">#存储估计值theta.hat和标准差se</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">514</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#importance function取f，逆变换法</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">log</span>(u)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>fg <span class="ot">&lt;-</span> <span class="fu">g</span>(x) <span class="sc">/</span> <span class="fu">exp</span>(<span class="dv">1</span><span class="sc">-</span>x)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>theta.hat[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(fg)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>se[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sd</span>(fg)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cbind</span>(theta.hat, se)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result, <span class="at">caption =</span> <span class="st">&quot;表4.1：利用importance sampling所生成的MC估计和标准差&quot;</span>)<span class="co">#kable绘制结果表格</span></span></code></pre></div>
<table>
<caption>表4.1：利用importance sampling所生成的MC估计和标准差</caption>
<thead>
<tr class="header">
<th align="right">theta.hat</th>
<th align="right">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4019571</td>
<td align="right">0.1574782</td>
</tr>
</tbody>
</table>
<p>从表4.1可以看到，所求积分的importance sampling估计约为0.4。</p>
</div>
<div id="a-21003-2021-10-14" class="section level2">
<h2>A-21003-2021-10-14</h2>
</div>
<div id="question-2" class="section level2">
<h2>Question</h2>
<ul>
<li><p>Exercises 6.5 and 6.A (pages 180-181, Statistical Computing with R).</p></li>
<li><p>If we obtain the powers for two methods under a particular simulation setting with 10,000 experiments: say, 0.651 for one method and 0.676 for another method. We want to know if the powers are different at 0.05 level.</p></li>
<li><p>What is the corresponding hypothesis test problem?</p></li>
<li><p>What test should we use? Z-test, two-sample t-test, paired-t test or McNemar test? Why?</p></li>
<li><p>Please provide the least necessary information for hypothesis testing.</p></li>
</ul>
</div>
<div id="answer-2" class="section level2">
<h2>Answer</h2>
<div id="section" class="section level3">
<h3>6.5</h3>
<p>容易知道均值的95%对称t置信区间由下式给出 <span class="math display">\[[\bar{X}-\frac{S}{\sqrt{n}}t_{n-1}(0.975), \bar{X}+\frac{S}{\sqrt{n}}t_{n-1}(0.975)]\]</span> 当样本来自<span class="math inline">\(\chi^{2}(2)\)</span>时，下面利用Monte Carlo方法估计上述t置信区间的覆盖概率，每次模拟样本量<span class="math inline">\(n=20\)</span>。R代码如下所示</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">605</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>calcCI <span class="ot">&lt;-</span> <span class="cf">function</span>(n, alpha){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n, <span class="dv">2</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  c1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">sd</span>(x)<span class="sc">*</span><span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>, n<span class="dv">-1</span>)<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  c2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="sc">+</span> <span class="fu">sd</span>(x)<span class="sc">*</span><span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>, n<span class="dv">-1</span>)<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">2</span><span class="sc">&gt;=</span>c1 <span class="sc">&amp;&amp;</span> <span class="dv">2</span><span class="sc">&lt;=</span>c2)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>ys <span class="ot">&lt;-</span> <span class="fu">replicate</span>(m, <span class="at">expr =</span> <span class="fu">calcCI</span>(n, alpha))</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">mean</span>(ys), <span class="at">caption =</span> <span class="st">&quot;表1.1：样本来自chi^2(2)时t置信区间的覆盖概率&quot;</span>)</span></code></pre></div>
<table>
<caption>表1.1：样本来自chi^2(2)时t置信区间的覆盖概率</caption>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9204</td>
</tr>
</tbody>
</table>
<p>可以看到当样本来自<span class="math inline">\(\chi^{2}(2)\)</span>时，上述均值的t置信区间的覆盖概率约为92%，小于理论值95%。<br />
下面按照Example 6.4的方式，将来自<span class="math inline">\(N(0,4)\)</span>的正态样本替换为来自<span class="math inline">\(\chi^{2}(2)\)</span>的样本，计算此时方差置信区间的覆盖概率。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">605</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ys <span class="ot">&lt;-</span> <span class="fu">replicate</span>(m, <span class="at">expr =</span> {</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n, <span class="dv">2</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> (n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">var</span>(x) <span class="sc">/</span> <span class="fu">qchisq</span>(alpha, <span class="at">df=</span>n<span class="dv">-1</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(c<span class="sc">&gt;</span><span class="dv">4</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">mean</span>(ys), <span class="at">caption =</span> <span class="st">&quot;表1.2：样本来自chi^2(2)时方差置信区间的覆盖概率&quot;</span>)</span></code></pre></div>
<table>
<caption>表1.2：样本来自chi^2(2)时方差置信区间的覆盖概率</caption>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.783</td>
</tr>
</tbody>
</table>
<p>从表1.2可以看到，当样本来自<span class="math inline">\(\chi^{2}(2)\)</span>时，Example 6.4方差置信区间的覆盖概率约为78%，与理论值95%差距甚远。进一步与上述t置信区间的覆盖概率（约92%）相比较，可以看到当样本偏离正态分布时，t置信区间比方差置信区间表现更加稳健。</p>
</div>
<div id="a" class="section level3">
<h3>6.A</h3>
<p>下面利用Monte Carlo模拟，探究当样本偏离正态分布时，均值t检验的第I类错误概率是否与给定的显著性水平<span class="math inline">\(\alpha\)</span>相等。检验问题为<span class="math inline">\(H_{0}: \mu = \mu_{0}\)</span> vs <span class="math inline">\(H_{1}: \mu \neq \mu_{0}\)</span></p>
<ul>
<li>(i)样本来自<span class="math inline">\(\chi^{2}(1)\)</span>时</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">replicate</span>(m, <span class="at">expr =</span> {</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(n, mu0)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">mu=</span>mu0)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> ttest<span class="sc">$</span>p.value</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>p.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(ps <span class="sc">&lt;</span> alpha)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(p.hat, <span class="at">caption =</span> <span class="st">&quot;表2.1：样本来自chi^2(1)时均值t检验的第I类错误概率&quot;</span>)</span></code></pre></div>
<table>
<caption>表2.1：样本来自chi^2(1)时均值t检验的第I类错误概率</caption>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.1056</td>
</tr>
</tbody>
</table>
<ul>
<li>(ii)样本来自<span class="math inline">\(U[0,2]\)</span>时</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">replicate</span>(m, <span class="at">expr =</span> {</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">mu=</span>mu0)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> ttest<span class="sc">$</span>p.value</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>p.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(ps <span class="sc">&lt;</span> alpha)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(p.hat, <span class="at">caption =</span> <span class="st">&quot;表2.2：样本来自U[0, 2]时均值t检验的第I类错误概率&quot;</span>)</span></code></pre></div>
<table>
<caption>表2.2：样本来自U[0, 2]时均值t检验的第I类错误概率</caption>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0507</td>
</tr>
</tbody>
</table>
<ul>
<li>(iii)样本来自<span class="math inline">\(\operatorname{Exp}(1)\)</span>时</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">replicate</span>(m, <span class="at">expr =</span> {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="dv">1</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">mu=</span>mu0)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> ttest<span class="sc">$</span>p.value</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>p.hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(ps <span class="sc">&lt;</span> alpha)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(p.hat, <span class="at">caption =</span> <span class="st">&quot;表2.3：样本来自Exp(1)时均值t检验的第I类错误概率&quot;</span>)</span></code></pre></div>
<table>
<caption>表2.3：样本来自Exp(1)时均值t检验的第I类错误概率</caption>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0803</td>
</tr>
</tbody>
</table>
<p>从表2.1-2.3可以看到，(i)样本来自<span class="math inline">\(\chi^{2}(1)\)</span>时，t检验的第I类错误概率约为0.1；(ii)样本来自<span class="math inline">\(U[0,2]\)</span>时，t检验的第I类错误概率略大于0.05；(iii)样本来自<span class="math inline">\(\operatorname{Exp}(1)\)</span>时，t检验的第I类错误概率约为0.08。因此整体来看，t检验在样本略微偏离正态分布时表现较为稳健；分情况对比来看，t检验在样本来自<span class="math inline">\(U[0,2]\)</span>时表现最稳健，在样本来自<span class="math inline">\(\operatorname{Exp}(1)\)</span>时表现次之，而在样本来自<span class="math inline">\(\chi^{2}(1)\)</span>时与理论值0.05差距最大，表现较差。</p>
</div>
<div id="question3" class="section level3">
<h3>Question3</h3>
<p>If we obtain the powers for two methods under a particular simulation setting with 10,000 experiments: say, 0.651 for one method and 0.676 for another method. We want to know if the powers are different at 0.05 level.</p>
<ul>
<li>What is the corresponding hypothesis test problem?</li>
</ul>
<p>首先定义两种检验(Test1, Test2)的势分别为：</p>
<p><span class="math inline">\(\pi_1(\theta_0)\)</span>=P(给定参数<span class="math inline">\(\theta=\theta_0\)</span>时Test1拒绝<span class="math inline">\(H_0\)</span>),</p>
<p><span class="math inline">\(\pi_2(\theta_0)\)</span>=P(给定参数<span class="math inline">\(\theta=\theta_0\)</span>时Test2拒绝<span class="math inline">\(H_0\)</span>)</p>
<p>则对应的假设检验问题为：<span class="math inline">\(H_{0}:\pi_{1}(\theta_0) = \pi_{2}(\theta_0)\longleftrightarrow H_{1}:\pi_{1}(\theta_0) \neq \pi_{2}(\theta_0)\)</span>，显著性水平<span class="math inline">\(\alpha\)</span>取0.05。<br />
</p>
<ul>
<li>What test should we use? Z-test, two-sample t-test, paired-t test or McNemar test? Why?</li>
</ul>
<p>由于10000次试验中所得到的数据为成对二分类数据（Test1/Test2是否拒绝了<span class="math inline">\(H_0\)</span>），所以此处应该使用McNemar test。<br />
</p>
<ul>
<li>Please provide the least necessary information for hypothesis testing.</li>
</ul>
<p>我们已经在此次模拟的10000次试验下得到了两种检验方法的势<span class="math inline">\(\pi_1=0.651\)</span>，<span class="math inline">\(\pi_2=0.676\)</span>。下面考虑每次试验中两种方法Test1, Test2得到的检验结果（是否拒绝了<span class="math inline">\(H_0\)</span>），可以将其表示为如下所示的2x2列联表</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>mat[<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;a + b&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>mat[<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;c&quot;</span>,<span class="st">&quot;d&quot;</span>,<span class="st">&quot;c + d&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>mat[<span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a + c&quot;</span>,<span class="st">&quot;b + d&quot;</span>,<span class="st">&quot;10000&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Test2 reject&quot;</span>,<span class="st">&quot;Test2 accpet&quot;</span>,<span class="st">&quot;Row total&quot;</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Test1 reject&quot;</span>,<span class="st">&quot;Test1 accpet&quot;</span>,<span class="st">&quot;Column total&quot;</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mat)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Test2 reject</th>
<th align="left">Test2 accpet</th>
<th align="left">Row total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Test1 reject</td>
<td align="left">a</td>
<td align="left">b</td>
<td align="left">a + b</td>
</tr>
<tr class="even">
<td align="left">Test1 accpet</td>
<td align="left">c</td>
<td align="left">d</td>
<td align="left">c + d</td>
</tr>
<tr class="odd">
<td align="left">Column total</td>
<td align="left">a + c</td>
<td align="left">b + d</td>
<td align="left">10000</td>
</tr>
</tbody>
</table>
<p>从模拟得到两种检验方法的势可知<span class="math inline">\(a+b=6510, a+c=6760\)</span>，对于McNemar test，其检验统计量<span class="math inline">\(\chi ^2 = \frac{(b-c)^2}{b+c}\)</span>在<span class="math inline">\(H_0\)</span>成立的情况下近似服从<span class="math inline">\(\chi ^2(1)\)</span>。因此为计算检验统计量<span class="math inline">\(\chi ^2\)</span>，<strong>我们还需要知道的最少信息为<span class="math inline">\(a\)</span>的值，即共有多少次试验Test1和Test2同时拒绝了原假设<span class="math inline">\(H_0\)</span>。</strong></p>
<p>最后若<span class="math inline">\(\chi ^2&gt;\chi ^2(0.95)\)</span>，则可认为两种检验方法的势在显著性水平0.05下是不同的。</p>
</div>
</div>
<div id="a-21003-2021-10-21" class="section level2">
<h2>A-21003-2021-10-21</h2>
</div>
<div id="question-3" class="section level2">
<h2>Question</h2>
<p>Exercises 6.C (pages 182, Statistical Computing with R).</p>
</div>
<div id="answer-3" class="section level2">
<h2>Answer</h2>
<div id="c" class="section level3">
<h3>6.C</h3>
<p>首先仿照<strong>Example 6.8</strong>，对Mardia多元偏度检验估计其第I类错误概率。由题知多元偏度统计量定义为 <span class="math display">\[
b_{1, d}=\frac{1}{n^{2}} \sum_{i, j=1}^{n}\left(\left(X_{i}-\bar{X}\right)^{T} \widehat{\Sigma}^{-1}\left(X_{j}-\bar{X}\right)\right)^{3}
\]</span> 且<span class="math inline">\(nb_{1, d}/6\)</span>的渐近分布为<span class="math inline">\(\chi^2(d(d+1)(d+2)/6)\)</span>，当<span class="math inline">\(nb_{1, d}/6&gt;\chi^2_{d(d+1)(d+2)/6}(1-\alpha)\)</span>时拒绝<span class="math inline">\(H_0:\beta_{1, d}=0\)</span>。下面仿照Example 6.8，取显著性水平<span class="math inline">\(\alpha=0.05\)</span>，样本容量<span class="math inline">\(n=10, 20, 30, 50, 100, 500\)</span>。由于统计量渐近分布不依赖于样本的均值和方差，故样本可由标准多元正态分布<span class="math inline">\(N_d(0, I_d)\)</span>生成，此处取维数<span class="math inline">\(d=2\)</span>。则对Mardia多元偏度检验，估计第I类错误概率的R代码如下所示</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#计算多元偏度统计量的函数</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>mvsk <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> <span class="fu">scale</span>(x, <span class="at">center=</span>T, <span class="at">scale=</span>F)<span class="co">#将样本矩阵x中心化</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)<span class="co">#获取样本量</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  sk <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>((xx <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">cov</span>(x)) <span class="sc">%*%</span> <span class="fu">t</span>(xx))<span class="sc">^</span><span class="dv">3</span>)<span class="co">#检验统计量</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sk)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>)<span class="co">#样本量</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">2</span><span class="co">#维数</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span><span class="co">#显著性水平</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="dv">1</span><span class="sc">-</span>alpha, d<span class="sc">*</span>(d<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>(d<span class="sc">+</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">6</span>)<span class="co">#检验临界值</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>p.reject <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(ns))<span class="co">#存储第I类错误估计值</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">1e4</span><span class="co">#模拟次数</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">99</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:length(ns)){</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   mvsktests &lt;- numeric(m)#存储每次试验的检验结果</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   for(j in 1:m){</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     x &lt;- mvrnorm(ns[i], mu = rep(0, d), Sigma = diag(d))#生成n个多元正态分布样本，维数为2</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     mvsktests[j] &lt;- as.integer(ns[i]*mvsk(x)/6 &gt;= cv)#拒绝H0取1，否则取0</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.reject[i] &lt;- mean(mvsktests)#拒绝H0的比例</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制结果表格</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co"># result &lt;- matrix(c(ns, p.reject), nrow = 2, ncol = length(ns), byrow = T)</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(result)[[1]] &lt;- c(&quot;n&quot;, &quot;Type I error rate&quot;)</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(result, caption = &quot;表1：Mardia多元偏度检验第I类错误概率估计&quot;)</span></span></code></pre></div>
<p>从表1可以看到，当样本量较小时（<span class="math inline">\(n\leq50\)</span>），多元偏度统计量的渐近分布拟合效果欠佳，估计值与真实显著性水平<span class="math inline">\(\alpha=0.05\)</span>差距较大。而当样本量较大时，多元偏度统计量的渐近分布拟合效果逐渐变好，估计值逐渐接近真实显著性水平<span class="math inline">\(\alpha=0.05\)</span>。</p>
<p><br />
下面仿照<strong>Example 6.10</strong>，在受污染的多元正态总体（混合正态）下，模拟估计Mardia多元偏度检验的势。其中受污染的多元正态分布定义为 <span class="math display">\[
(1-\varepsilon) N_d\left(0, I_d\right)+\varepsilon N_d\left(0, 100I_d\right), \quad 0 \leq \varepsilon \leq 1
\]</span> 当<span class="math inline">\(\varepsilon=0\)</span>或<span class="math inline">\(\varepsilon=1\)</span>时该分布为多元正态分布，但<span class="math inline">\(0 &lt; \varepsilon &lt; 1\)</span>时不是多元正态分布。我们可以取一列<span class="math inline">\(\varepsilon\)</span>估计Mardia多元偏度检验的势，并绘制出相应的势曲线。类似于Example 6.10，此次模拟取显著性水平<span class="math inline">\(\alpha=0.1\)</span>。多元偏度统计量的计算仍沿用函数<code>mvsk</code>。则估计Mardia多元偏度检验势的R代码如下所示</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.1</span><span class="co">#显著性水平</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span><span class="co">#样本量</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">2500</span><span class="co">#模拟次数</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">2</span><span class="co">#维数</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.15</span>, <span class="fl">0.01</span>), <span class="fu">seq</span>(<span class="fl">0.15</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))<span class="co">#混合分布比例序列e</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(epsilon)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>pwr <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)<span class="co">#存储每次模拟检验的势</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="dv">1</span><span class="sc">-</span>alpha, d<span class="sc">*</span>(d<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>(d<span class="sc">+</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">6</span>)<span class="co">#检验临界值</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:N){ #对每个epsilon</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   mvsktests &lt;- numeric(m)#存储每次试验结果，拒绝H0取1，否则取0</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   e &lt;- epsilon[i]#混合分布比例e</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   for(j in 1:m){ #对每次试验</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     x1 &lt;- mvrnorm(n, rep(0, d), diag(d))#生成多元正态样本N(0, I)</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     x2 &lt;- mvrnorm(n, rep(0, d), 100*diag(d))#生成多元正态样本N(0, 100*I)</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     emat &lt;- diag(as.integer(runif(n) &lt;= e))#为生成混合分布构造系数矩阵，对角线元素以概率e取1，以概率1-e取0</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     x &lt;- (diag(n)-emat) %*% x1 + emat %*% x2#生成混合分布样本，每行以概率1-e取N(0, I)，以概率e取N(0, 100*I)</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     mvsktests[j] &lt;- as.integer(n*mvsk(x)/6 &gt;= cv)#检验结果拒绝H0取1，否则取0</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   pwr[i] &lt;- mean(mvsktests)#估计检验的势</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制power vs epsilon曲线</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(epsilon, pwr, type = &quot;b&quot;,</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">#      xlab = bquote(epsilon), ylim = c(0,1))</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(h = alpha, lty = 3)</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># se &lt;- sqrt(pwr * (1-pwr) / m) #添加标准差</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(epsilon, pwr+se, lty = 3)</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(epsilon, pwr-se, lty = 3)</span></span></code></pre></div>
<p>从图1可以看到，当<span class="math inline">\(\varepsilon=0,1\)</span>时，检验的势曲线与水平线<span class="math inline">\(\alpha=0.1\)</span>相交，说明样本服从多元正态分布；而当<span class="math inline">\(0 &lt; \varepsilon &lt; 1\)</span>时，检验的势大于真实值0.1，并且随<span class="math inline">\(\varepsilon\)</span>的增加先增加后逐渐减小，说明此时样本不服从多元正态分布。</p>
</div>
</div>
<div id="a-21003-2021-10-28" class="section level2">
<h2>A-21003-2021-10-28</h2>
</div>
<div id="question-4" class="section level2">
<h2>Question</h2>
<p>Exercises 7.7, 7.8, 7.9 and 7.B (pages 213, Statistical Computing with R).</p>
</div>
<div id="answer-4" class="section level2">
<h2>Answer</h2>
<div id="section-1" class="section level3">
<h3>7.7</h3>
<p>根据题意,对数据集<code>scor</code>我们感兴趣的参数为 <span class="math display">\[
\theta=\frac{\lambda_{1}}{\sum_{j=1}^{5} \lambda_{j}}
\]</span> 其中<span class="math inline">\(\lambda_{1}&gt;\cdots&gt;\lambda_{5}\)</span>为协方差矩阵<span class="math inline">\(\Sigma\)</span>的特征值。下面计算<span class="math inline">\(\theta\)</span>的样本估计<span class="math inline">\(\hat{\theta}\)</span>，并利用bootstrap估计<span class="math inline">\(\hat{\theta}\)</span>的偏差和标准差。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bootstrap)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(scor)<span class="co">#计算协方差矩阵的MLE</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">&lt;-</span> <span class="fu">eigen</span>(Sigma)<span class="sc">$</span>values<span class="co">#特征值</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>theta_hat <span class="ot">&lt;-</span> lambda_hat[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(lambda_hat)<span class="co">#theta的样本估计</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#计算theta bootstrap估计的函数，以传给boot的参数statistic</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>theta_i <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, inds){</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(dat[inds,])</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">eigen</span>(Sigma)<span class="sc">$</span>values</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lambda[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(lambda))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">77</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>obj_boot <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>scor, <span class="at">statistic=</span>theta_i, <span class="at">R=</span><span class="dv">200</span>)<span class="co">#利用boot进行bootstrap抽样</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>theta_boot <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(obj_boot<span class="sc">$</span>t)<span class="co">#bootstrap估计值</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>bias_boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(theta_boot) <span class="sc">-</span> theta_hat<span class="co">#bootstrap的偏差估计</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>se_boot <span class="ot">&lt;-</span> <span class="fu">sd</span>(theta_boot)<span class="co">#bootstrap的标准差估计</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制结果表格</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(theta_hat, bias_boot, se_boot), <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(result)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;theta_hat&quot;</span>, <span class="st">&quot;bias_boot&quot;</span>, <span class="st">&quot;se_boot&quot;</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result, <span class="at">caption =</span> <span class="st">&quot;表1.1：theta的样本估计和bootstrap的偏差和标准差估计结果&quot;</span>)</span></code></pre></div>
<table>
<caption>表1.1：theta的样本估计和bootstrap的偏差和标准差估计结果</caption>
<thead>
<tr class="header">
<th align="right">theta_hat</th>
<th align="right">bias_boot</th>
<th align="right">se_boot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.619115</td>
<td align="right">-0.00026</td>
<td align="right">0.0461956</td>
</tr>
</tbody>
</table>
</div>
<div id="section-2" class="section level3">
<h3>7.8</h3>
<p>接题7.7，下面利用jackknife估计<span class="math inline">\(\hat{\theta}\)</span>的偏差和标准差。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(scor)<span class="co">#计算协方差矩阵的MLE</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">&lt;-</span> <span class="fu">eigen</span>(Sigma)<span class="sc">$</span>values<span class="co">#特征值</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>theta_hat <span class="ot">&lt;-</span> lambda_hat[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(lambda_hat)<span class="co">#theta的样本估计</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(scor)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>theta_jack <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> scor[<span class="sc">-</span>i,]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(dat)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">eigen</span>(Sigma)<span class="sc">$</span>values</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  theta_jack[i] <span class="ot">&lt;-</span> lambda[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(lambda)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>bias_jack <span class="ot">&lt;-</span> (n<span class="dv">-1</span>)<span class="sc">*</span>(<span class="fu">mean</span>(theta_jack) <span class="sc">-</span> theta_hat)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>se_jack <span class="ot">&lt;-</span> (n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">var</span>(theta_jack)<span class="sc">/</span>n)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制结果表格</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(bias_jack, se_jack), <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(result)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;bias_jack&quot;</span>, <span class="st">&quot;se_jack&quot;</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result, <span class="at">caption =</span> <span class="st">&quot;表2.1：jackknife的偏差和标准差估计结果&quot;</span>)</span></code></pre></div>
<table>
<caption>表2.1：jackknife的偏差和标准差估计结果</caption>
<thead>
<tr class="header">
<th align="right">bias_jack</th>
<th align="right">se_jack</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0010691</td>
<td align="right">0.0495523</td>
</tr>
</tbody>
</table>
</div>
<div id="section-3" class="section level3">
<h3>7.9</h3>
<p>接题7.7，下面利用<code>boot.ci</code>函数计算<span class="math inline">\(\hat{\theta}\)</span>的95% percentile和BCa置信区间。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">79</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>obj_boot <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>scor, <span class="at">statistic=</span>theta_i, <span class="at">R=</span><span class="dv">2000</span>)<span class="co">#利用boot函数进行bootstrap抽样</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(obj_boot, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;perc&quot;</span>, <span class="st">&quot;bca&quot;</span>))<span class="co">#利用boot.ci函数计算95% percentile和BCa置信区间</span></span></code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 2000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = obj_boot, type = c(&quot;perc&quot;, &quot;bca&quot;))
## 
## Intervals : 
## Level     Percentile            BCa          
## 95%   ( 0.5166,  0.7070 )   ( 0.5187,  0.7097 )  
## Calculations and Intervals on Original Scale</code></pre>
<p>从上述结果可以看到，percentile方法和BCa方法得到的95%置信区间非常接近，说明在本题情况下两种方法都较为稳健。</p>
</div>
<div id="b" class="section level3">
<h3>7.B</h3>
<p>下面利用Monte Carlo模拟，对偏度分别估计(i)standard normal bootstrap置信区间，(ii)basic bootstrap置信区间，(iii)percentile置信区间的覆盖概率，并在上述置信区间不包含待估参数（偏度）时，分别统计待估参数位于上述三种置信区间左边（miss on the left）和右边（miss on the right）的比例。其中偏度定义为 <span class="math display">\[
\sqrt{\beta_{1}}=\frac{E\left[\left(X-\mu_{X}\right)\right]^{3}}{\sigma_{X}^{3}}
\]</span> 相应的样本偏度定义为 <span class="math display">\[
\sqrt{b_{1}}=\frac{\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\bar{X}\right)^{3}}{\left(\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\bar{X}\right)^{2}\right)^{3 / 2}}
\]</span></p>
<ul>
<li>样本来自正态总体<span class="math inline">\(N(0,1)\)</span>时，可以计算其偏度为0</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#计算样本偏度</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>sk_i <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, inds){</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> dat[inds]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">mean</span>((x <span class="sc">-</span> xbar)<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  m2 <span class="ot">&lt;-</span> <span class="fu">mean</span>((x <span class="sc">-</span> xbar)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  sk <span class="ot">&lt;-</span> m3 <span class="sc">/</span> m2<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sk)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span><span class="co">#显著性水平</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span><span class="co">#样本量</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">5e3</span><span class="co">#MC模拟次数</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>sk <span class="ot">&lt;-</span> <span class="dv">0</span><span class="co">#正态分布偏度系数</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">3</span>)<span class="co">#存储CI是否覆盖参数</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>CI_miss <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">6</span>)<span class="co">#存储CI位置，1-3列为参数是否落在3种CI左边，4-6列为参数是否落在3种CI右边</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:m){</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- rnorm(n)#生成正态样本</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_boot &lt;- boot(data = x, statistic = sk_i, R=2000)#利用boot函数进行bootstrap抽样</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_ci &lt;- boot.ci(obj_boot, conf = 1-alpha, type = c(&quot;norm&quot;,&quot;basic&quot;, &quot;perc&quot;))#利用boot.ci函数计算95%置信区间</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   LCLs &lt;- c(obj_ci[[&quot;normal&quot;]][1,2], obj_ci[[&quot;basic&quot;]][1,4], obj_ci[[&quot;percent&quot;]][1,4])#置信区间下界</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   UCLs &lt;- c(obj_ci[[&quot;normal&quot;]][1,3], obj_ci[[&quot;basic&quot;]][1,5], obj_ci[[&quot;percent&quot;]][1,5])#置信区间上界</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   y[i,] &lt;- as.integer(sk &gt; LCLs &amp; sk &lt; UCLs)#CI是否覆盖参数</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   CI_miss[i,] &lt;- as.integer(c(sk &lt; LCLs, sk &gt; UCLs))#CI位置，1-3列为参数是否落在3种CI左边，4-6列为参数是否落在3种CI右边</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制结果表格</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="co"># cp &lt;- apply(y, 2, mean)</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="co"># cp &lt;- matrix(cp, nrow = 1)</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(cp)[[2]] &lt;- c(&quot;standard normal bootstrap&quot;, &quot;basic bootstrap&quot;, &quot;percentile&quot;)</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(cp, caption = &quot;表4.1：三种bootstrap置信区间覆盖概率的MC估计（正态样本）&quot;)</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co"># CI_left &lt;- apply(CI_miss[,1:3], 2, mean)</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># CI_right &lt;- apply(CI_miss[,4:6], 2, mean)</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co"># miss_prop &lt;- rbind(CI_left, CI_right)</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(miss_prop)[[2]] &lt;- c(&quot;standard normal bootstrap&quot;, &quot;basic bootstrap&quot;, &quot;percentile&quot;)</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(miss_prop, caption = &quot;表4.2：偏度位于三种bootstrap置信区间左边/右边的比例（正态样本）&quot;)</span></span></code></pre></div>
<ul>
<li>样本来自卡方总体<span class="math inline">\(\chi^2(5)\)</span>时，可以计算其偏度为<span class="math inline">\(\sqrt{8/5}\)</span></li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span><span class="co">#样本量</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">5e3</span><span class="co">#MC模拟次数</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>sk <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">8</span><span class="sc">/</span><span class="dv">5</span>)<span class="co">#卡方分布chi^2(5)偏度系数</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">3</span>)<span class="co">#存储CI是否覆盖参数</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>CI_miss <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">6</span>)<span class="co">#存储CI位置，1-3列为参数是否落在3种CI左边，4-6列为参数是否落在3种CI右边</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:m){</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- rchisq(n, 5)#生成卡方样本</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_boot &lt;- boot(data = x, statistic = sk_i, R=2000)#利用boot函数进行bootstrap抽样</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_ci &lt;- boot.ci(obj_boot, conf = 1-alpha, type = c(&quot;norm&quot;,&quot;basic&quot;, &quot;perc&quot;))#利用boot.ci函数计算95%置信区间</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   LCLs &lt;- c(obj_ci[[&quot;normal&quot;]][1,2], obj_ci[[&quot;basic&quot;]][1,4], obj_ci[[&quot;percent&quot;]][1,4])#置信区间下界</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   UCLs &lt;- c(obj_ci[[&quot;normal&quot;]][1,3], obj_ci[[&quot;basic&quot;]][1,5], obj_ci[[&quot;percent&quot;]][1,5])#置信区间上界</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   y[i,] &lt;- as.integer(sk &gt; LCLs &amp; sk &lt; UCLs)#CI是否覆盖参数</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   CI_miss[i,] &lt;- as.integer(c(sk &lt; LCLs, sk &gt; UCLs))#CI位置，1-3列为参数是否落在3种CI左边，4-6列为参数是否落在3种CI右边</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制结果表格</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># cp &lt;- apply(y, 2, mean)</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># cp &lt;- matrix(cp, nrow = 1)</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(cp)[[2]] &lt;- c(&quot;standard normal bootstrap&quot;, &quot;basic bootstrap&quot;, &quot;percentile&quot;)</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(cp, caption = &quot;表4.3：三种bootstrap置信区间覆盖概率的MC估计（卡方样本）&quot;)</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co"># CI_left &lt;- apply(CI_miss[,1:3], 2, mean)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co"># CI_right &lt;- apply(CI_miss[,4:6], 2, mean)</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co"># miss_prop &lt;- rbind(CI_left, CI_right)</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(miss_prop)[[2]] &lt;- c(&quot;standard normal bootstrap&quot;, &quot;basic bootstrap&quot;, &quot;percentile&quot;)</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(miss_prop, caption = &quot;表4.4：偏度位于三种bootstrap置信区间左边/右边的比例（卡方样本）&quot;)</span></span></code></pre></div>
<p>从表4.1和表4.3可以看到，正态分布样本相比卡方分布样本，三种bootstrap置信区间的覆盖概率均较高且接近于理论值95%。</p>
<p>从表4.2和表4.4可以看到，当样本来自正态分布时，偏度系数位于bootstrap置信区间左边（miss on the left）和右边（miss on the right）的比例基本相同，说明正态分布是无偏的（偏度为0）；而当样本来自卡方分布时，偏度系数位于bootstrap置信区间右边（miss on the right）大于左边（miss on the left）的比例，说明卡方分布具有正的偏度。</p>
</div>
</div>
<div id="a-21003-2021-11-04" class="section level2">
<h2>A-21003-2021-11-04</h2>
</div>
<div id="question-5" class="section level2">
<h2>Question</h2>
<p>Exercises 8.2 (pages 242, Statistical Computing with R).</p>
<p>Discussion：Design experiments for evaluating the performance of the NN, energy, and ball methods in various situations.</p>
</div>
<div id="answer-5" class="section level2">
<h2>Answer</h2>
<div id="section-4" class="section level3">
<h3>8.2</h3>
<p>对数据集<code>iris</code>，探究鸢尾属植物Iris Setosa的（花瓣长度，花瓣宽度）和（花萼长度，花萼宽度）对应的二元分布是否相互独立。以permutation test的方式应用二元Spearman秩相关检验。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;iris&quot;</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>setosa <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> setosa[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]<span class="co">#sepal</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> setosa[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]<span class="co">#petal</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#计算rho permutation估计的函数，以传给boot的参数statistic</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>rho_i <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, inds){</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> dat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> dat[inds, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(x, y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)<span class="sc">$</span>estimate</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rho)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">802</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>obj_boot <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>setosa, <span class="at">statistic=</span>rho_i, <span class="at">sim=</span><span class="st">&quot;permutation&quot;</span>, <span class="at">R=</span><span class="dv">999</span>)<span class="co">#permutation</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>rho_perm <span class="ot">&lt;-</span> <span class="fu">c</span>(obj_boot<span class="sc">$</span>t, obj_boot<span class="sc">$</span>t0)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">mean</span>(rho_perm <span class="sc">&gt;</span> obj_boot<span class="sc">$</span>t0)<span class="co">#显著性水平的permutation估计</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>phat</span></code></pre></div>
<pre><code>## [1] 0.005</code></pre>
<p>permutation得到的显著性水平为0.005，则在<span class="math inline">\(\alpha=0.05\)</span>下拒绝原假设（二者独立）。而利用<code>cor.test</code>得到的检验结果p值为</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(x, y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)<span class="sc">$</span>p.value</span></code></pre></div>
<pre><code>## [1] 1.652371e-26</code></pre>
<p>可以看到，利用<code>cor.test</code>的检验结果与permutation相同，都拒绝了原假设。</p>
</div>
<div id="discussion" class="section level3">
<h3>Discussion</h3>
<p>Design experiments for evaluating the performance of the NN, energy, and ball methods in various situations.</p>
<ol style="list-style-type: decimal">
<li>Unequal variances and equal expectations</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(RANN)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(energy)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(Ball)</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># #NN统计量</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tn &lt;- function(dat, inds, sizes, k){</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   n1 &lt;- sizes[1]</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   n2 &lt;- sizes[2]</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   n &lt;- n1 + n2</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   if(is.vector(dat)) </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     dat &lt;- data.frame(dat)</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   dat &lt;- dat[inds, ]</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   NN &lt;- nn2(data=dat, k=k+1)</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   block1 &lt;- NN$nn.idx[1:n1,-1]</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   block2 &lt;- NN$nn.idx[(n1+1):n,-1]</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   i1 &lt;- sum(block1 &lt;= n1)</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   i2 &lt;- sum(block2 &gt; n1)</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   return((i1 + i2) / (k * n))</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># #NN假设检验</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># eqdist.nn &lt;- function(dat, sizes, k){</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_boot &lt;- boot(data=dat, statistic=Tn, R=R, sim = &quot;permutation&quot;, sizes = sizes, k=k)</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   ts &lt;- c(obj_boot$t0, obj_boot$t)</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.value &lt;- mean(ts&gt;=ts[1])</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(list(statistic=ts[1], p.value=p.value))</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co"># m &lt;- 1000#模拟次数</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># d &lt;- 2#维数</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="co"># k &lt;- 3#NN检验参数取3</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co"># n1 &lt;- n2 &lt;- 50#样本量</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co"># R &lt;- 999#permutation个数</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="co"># n &lt;- n1 + n2</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="co"># N &lt;- c(n1, n2)</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co"># p.values &lt;- matrix(nrow = m, ncol = 3)#存储每次模拟p值</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="co"># alpha &lt;- 0.05</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="co"># #Unequal variances and equal expectations</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="co"># sigma &lt;- 1.5</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(11041)</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:m){</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- matrix(rnorm(n1*d, 0, 1), ncol = d)</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   y &lt;- matrix(rnorm(n2*d, 0, sigma), ncol = d)</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   dat &lt;- rbind(x, y)</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 1] &lt;- eqdist.nn(dat, N, k)$p.value#NN</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 2] &lt;- eqdist.etest(dat, sizes = N, R=R)$p.value#energy</span></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 3] &lt;- bd.test(x=x, y=y, num.permutations = R, seed = i*11041)$p.value#ball</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a><span class="co"># pow &lt;- matrix(colMeans(p.values &lt; alpha), ncol = 3)#模拟得到三种检验的势</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(pow)[[2]] &lt;- c(&quot;NN&quot;, &quot;energy&quot;, &quot;ball&quot;)</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(pow, caption = &quot;表2.1：NN, energy和ball三种检验方法的势(Unequal variances and equal expectations)&quot;)</span></span></code></pre></div>
<p>从表2.1可以看到，当正态分布均值相同而方差不同时，ball相比NN和energy检验表现更好。</p>
<ol start="2" style="list-style-type: decimal">
<li>Unequal variances and unequal expectations</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>p.values <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">3</span>)<span class="co">#存储每次模拟p值</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11042</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:m){</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- matrix(rnorm(n1*d, 0, 1), ncol = d)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   y &lt;- matrix(rnorm(n2*d, mu, sigma), ncol = d)#Unequal variances and unequal expectations</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   dat &lt;- rbind(x, y)</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 1] &lt;- eqdist.nn(dat, N, k)$p.value#NN</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 2] &lt;- eqdist.etest(dat, sizes = N, R=R)$p.value#energy</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 3] &lt;- bd.test(x=x, y=y, num.permutations = R, seed = i*11041)$p.value#ball</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pow &lt;- matrix(colMeans(p.values &lt; alpha), ncol = 3)#模拟得到三种检验的势</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(pow)[[2]] &lt;- c(&quot;NN&quot;, &quot;energy&quot;, &quot;ball&quot;)</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(pow, caption = &quot;表2.2：NN, energy和ball三种检验方法的势(Unequal variances and unequal expectations)&quot;)</span></span></code></pre></div>
<p>从表2.2可以看到，当正态分布均值和方差都不相等时，ball相比NN和energy检验表现更好。</p>
<ol start="3" style="list-style-type: decimal">
<li>Non-normal distributions: t distribution with 1 df (heavy-tailed distribution), bimodel distribution (mixture of two normal distributions)</li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#生成bimodel distribution随机数</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rbinorm <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">mu=</span><span class="dv">2</span>, <span class="at">sigma=</span><span class="dv">2</span>){</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  inds <span class="ot">&lt;-</span> <span class="fu">which</span>(u <span class="sc">&lt;</span> <span class="fl">0.5</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  x[inds] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">sum</span>(u <span class="sc">&lt;</span> <span class="fl">0.5</span>))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  x[<span class="sc">-</span>inds] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n <span class="sc">-</span> <span class="fu">sum</span>(u <span class="sc">&lt;</span> <span class="fl">0.5</span>), mu, sigma)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>p.values <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">3</span>)<span class="co">#存储每次模拟p值</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11043</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:m){</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- rt(n1, df=1)#t distribution</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   y &lt;- rbinorm(n2)#bimodel distribution</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   dat &lt;- c(x, y)</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 1] &lt;- eqdist.nn(dat, N, k)$p.value#NN</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 2] &lt;- eqdist.etest(dat, sizes = N, R=R)$p.value#energy</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 3] &lt;- bd.test(x=x, y=y, num.permutations = R, seed = i*11041)$p.value#ball</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># pow &lt;- matrix(colMeans(p.values &lt; alpha), ncol = 3)#模拟得到三种检验的势</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(pow)[[2]] &lt;- c(&quot;NN&quot;, &quot;energy&quot;, &quot;ball&quot;)</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(pow, caption = &quot;表2.3：NN, energy和ball三种检验方法的势(Non-normal distributions)&quot;)</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ```</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 从表2.3可以看到，对于非正态分布情形，energy相比NN和ball检验表现更好。</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co"># (4) Unbalanced samples (say, 1 case versus 10 controls)</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co"># ```{r}</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co"># n1 &lt;- 10</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co"># n2 &lt;- 10 * n1#Unbalanced samples</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="co"># n &lt;- n1 + n2</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="co"># N &lt;- c(n1, n2)</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="co"># mu &lt;- 0.5</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="co"># p.values &lt;- matrix(nrow = m, ncol = 3)#存储每次模拟p值</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(11044)</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:m){</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- rnorm(n1, 0, 1)</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   y &lt;- rnorm(n2, mu, 1)</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   dat &lt;- c(x, y)</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 1] &lt;- eqdist.nn(dat, N, k)$p.value#NN</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 2] &lt;- eqdist.etest(dat, sizes = N, R=R)$p.value#energy</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   p.values[i, 3] &lt;- bd.test(x=x, y=y, num.permutations = R, seed = i*11041)$p.value#ball</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="co"># pow &lt;- matrix(colMeans(p.values &lt; alpha), ncol = 3)#模拟得到三种检验的势</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="co"># dimnames(pow)[[2]] &lt;- c(&quot;NN&quot;, &quot;energy&quot;, &quot;ball&quot;)</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(pow, caption = &quot;表2.4：NN, energy和ball三种检验方法的势(Unbalanced samples)&quot;)</span></span></code></pre></div>
<p>从表2.4可以看到，对于类别不平衡情形，energy相比NN和ball检验表现更好。</p>
</div>
</div>
<div id="a-21003-2021-11-11" class="section level2">
<h2>A-21003-2021-11-11</h2>
</div>
<div id="question-6" class="section level2">
<h2>Question</h2>
<p>Exercises 9.3 and 9.8 (pages 277-278, Statistical Computing with R).</p>
<p>For each of the above exercise, use the Gelman-Rubin method to monitor convergence of the chain, and run the chain until it converges approximately to the target distribution according to <span class="math inline">\(\hat{R}&lt;1.2\)</span>.</p>
</div>
<div id="answer-6" class="section level2">
<h2>Answer</h2>
<div id="section-5" class="section level3">
<h3>9.3</h3>
<p>选取proposal distribution为标准正态分布<span class="math inline">\(N(X_t, \sigma^2)\)</span>，其与目标分布<span class="math inline">\(Cauchy(1,0)\)</span>具有相同支撑，通常能够满足正则条件。则利用Metropolis-Hastings sampler生成标准柯西分布随机数的R代码如下所示</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#柯西分布密度</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  fx <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (pi<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fx)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1193</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="co">#记录拒绝次数</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(m)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#生成马氏链</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>m){</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  xt <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, xt, <span class="dv">1</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  num <span class="ot">&lt;-</span> <span class="fu">f</span>(y) <span class="sc">*</span> <span class="fu">dnorm</span>(xt, y, <span class="dv">1</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  den <span class="ot">&lt;-</span> <span class="fu">f</span>(xt) <span class="sc">*</span> <span class="fu">dnorm</span>(y, xt, <span class="dv">1</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> num <span class="sc">/</span> den</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(u[i] <span class="sc">&lt;=</span> r){</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> xt</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co">#比较MH和真实柯西分布的分位数</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1001</span><span class="sc">:</span>m)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>yMH <span class="ot">&lt;-</span> x[index]</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">quantile</span>(yMH, ps), <span class="fu">qcauchy</span>(ps))<span class="co">#绘制结果表格</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(result)[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Metropolis-Hastings&quot;</span>, <span class="st">&quot;True&quot;</span>)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result, <span class="at">caption =</span> <span class="st">&quot;表1.1：分位数对比结果&quot;</span>)</span></code></pre></div>
<table>
<caption>表1.1：分位数对比结果</caption>
<colgroup>
<col width="18%" />
<col width="9%" />
<col width="9%" />
<col width="10%" />
<col width="10%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">10%</th>
<th align="right">20%</th>
<th align="right">30%</th>
<th align="right">40%</th>
<th align="right">50%</th>
<th align="right">60%</th>
<th align="right">70%</th>
<th align="right">80%</th>
<th align="right">90%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Metropolis-Hastings</td>
<td align="right">-2.593181</td>
<td align="right">-1.271254</td>
<td align="right">-0.6557718</td>
<td align="right">-0.2913120</td>
<td align="right">0.0345928</td>
<td align="right">0.3424151</td>
<td align="right">0.7466429</td>
<td align="right">1.401148</td>
<td align="right">3.031550</td>
</tr>
<tr class="even">
<td align="left">True</td>
<td align="right">-3.077684</td>
<td align="right">-1.376382</td>
<td align="right">-0.7265425</td>
<td align="right">-0.3249197</td>
<td align="right">0.0000000</td>
<td align="right">0.3249197</td>
<td align="right">0.7265425</td>
<td align="right">1.376382</td>
<td align="right">3.077684</td>
</tr>
</tbody>
</table>
<p>从表1.1可以看到，利用Metropolis-Hastings sampler生成的柯西分布与真实柯西分布二者分位数较为接近。</p>
</div>
<div id="section-6" class="section level3">
<h3>9.8</h3>
<p>由题知该二元密度<span class="math inline">\(f(x,y),\quad x=0,1,...,n,0\leq y\leq 1\)</span>的条件分布分别为<span class="math inline">\(Binomial(n,y)\)</span>和<span class="math inline">\(Beta(x+a, n-x+b)\)</span>。则可以利用Gibbs sampler生成该二元密度的随机数，R代码如下所示</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gibbs sampler function, 固定n=10, a=1, b=2</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Gibbs <span class="ot">&lt;-</span> <span class="cf">function</span>(N, x0, y0, <span class="at">n=</span><span class="dv">10</span>, <span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">2</span>){</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> N, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#初始化</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x0</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y0</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  X[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N){</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> X[i<span class="dv">-1</span>, <span class="dv">2</span>]</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    X[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, y)<span class="co">#x|y为Binomial(n,y)</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> X[i, <span class="dv">1</span>]</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    X[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x<span class="sc">+</span>a, n<span class="sc">-</span>x<span class="sc">+</span>b)<span class="co">#y|x为Beta(x+a, n-x+b)</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(X)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1198</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fl">0.5</span><span class="sc">*</span>n</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> (x0<span class="sc">+</span>a) <span class="sc">/</span> (n<span class="sc">+</span>a<span class="sc">+</span>b)<span class="co">#初始化</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">Gibbs</span>(N, x0, y0)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>XGibbs <span class="ot">&lt;-</span> X[(burn<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>N,]</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(XGibbs, cex=0.5, xlab=&quot;x&quot;, ylab=&quot;y&quot;)#XY散点图</span></span></code></pre></div>
<p>从上图可以看到，显然<span class="math inline">\(X\)</span>为离散分布，<span class="math inline">\(Y\)</span>为连续分布且均值随<span class="math inline">\(X\)</span>增大而增大，其特征与真实分布相符合。</p>
</div>
<div id="discussion-1" class="section level3">
<h3>Discussion</h3>
<p>For each of the above exercise, use the Gelman-Rubin method to monitor convergence of the chain, and run the chain until it converges approximately to the target distribution according to <span class="math inline">\(\hat{R}&lt;1.2\)</span>.</p>
<ul>
<li><strong>exercise 9.3</strong></li>
</ul>
<p>对Metropolis-Hastings sampler生成的柯西分布利用Gelman-Rubin方法观测收敛性，其中Gelman-Rubin函数沿用书中样例。取number of chains=4， length of chains=15000。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#生成柯西分布马氏链</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>cauchy.chain <span class="ot">&lt;-</span> <span class="cf">function</span>(x0, m){</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">1</span>] <span class="ot">&lt;-</span> x0</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="co">#记录拒绝次数</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(m)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#生成马氏链</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>m){</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    xt <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, xt, <span class="dv">1</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    num <span class="ot">&lt;-</span> <span class="fu">dcauchy</span>(y) <span class="sc">*</span> <span class="fu">dnorm</span>(xt, y, <span class="dv">1</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    den <span class="ot">&lt;-</span> <span class="fu">dcauchy</span>(xt) <span class="sc">*</span> <span class="fu">dnorm</span>(y, xt, <span class="dv">1</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> num <span class="sc">/</span> den</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(u[i] <span class="sc">&lt;=</span> r){</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>      x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>      x[i] <span class="ot">&lt;-</span> xt</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Gelman-Rubin方法计算Rhat</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>Gelman.Rubin <span class="ot">&lt;-</span> <span class="cf">function</span>(psi){</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># psi[i,j] is the statistic psi(X[i,1:j]) for chain in i-th row of X</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  psi <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(psi)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(psi)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">nrow</span>(psi)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  psi.means <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(psi)     <span class="co">#row means</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> n <span class="sc">*</span> <span class="fu">var</span>(psi.means)        <span class="co">#between variance est.</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  psi.w <span class="ot">&lt;-</span> <span class="fu">apply</span>(psi, <span class="dv">1</span>, <span class="st">&quot;var&quot;</span>)  <span class="co">#within variances</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">mean</span>(psi.w)               <span class="co">#within est.</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  v.hat <span class="ot">&lt;-</span> W<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span>n <span class="sc">+</span> (B<span class="sc">/</span>n)     <span class="co">#upper variance est.</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>  r.hat <span class="ot">&lt;-</span> v.hat <span class="sc">/</span> W             <span class="co">#G-R statistic</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(r.hat)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">113</span>)</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">4</span><span class="co">#chain的个数</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">15000</span><span class="co">#chain的长度</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">10</span>)<span class="co">#初始值</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="co"># X &lt;- matrix(nrow = k, ncol = m)</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:k)</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   X[i,] &lt;- cauchy.chain(x0[i], m)</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="co"># #计算检验统计量psi</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="co"># psi &lt;- t(apply(X, 1, cumsum))</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:nrow(psi))</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   psi[i,] &lt;- psi[i,] / (1:ncol(psi))</span></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制psi</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(2, 2))</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:k)</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(psi[i, (burn+1):m], type=&quot;l&quot;, xlab=i, ylab=bquote(psi))</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制Rhat</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(1, 1))</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a><span class="co"># rhat &lt;- numeric(m)</span></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="co"># for(j in (burn+1):m)</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   rhat[j] &lt;- Gelman.Rubin(psi[,1:j])</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(rhat[(burn+1):m], type=&quot;l&quot;, xlab=&quot;&quot;, ylab=&quot;R&quot;)</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(h=1.2, lty=2)</span></span></code></pre></div>
<p>可以看到<span class="math inline">\(\hat{R}\)</span>约在2500次迭代后收敛到目标值<span class="math inline">\(1.2\)</span>。</p>
<ul>
<li><strong>exercise 9.8</strong></li>
</ul>
<p>对Gibbs sampler所生成<span class="math inline">\((X,Y)\)</span>的边缘分布分别利用Gelman-Rubin方法观测其收敛性。取number of chains=3， length of chains=15000，与exercise 9.8相同固定参数<span class="math inline">\(n=10, a=1, b=2\)</span>。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">98</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span><span class="co">#chain的个数</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">15000</span><span class="co">#chain的长度</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)<span class="co">#初始值</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> (x0<span class="sc">+</span>a) <span class="sc">/</span> (n<span class="sc">+</span>a<span class="sc">+</span>b)<span class="co">#初始化</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> k, <span class="at">ncol =</span> m)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> k, <span class="at">ncol =</span> m)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:k){</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   XY &lt;- t(Gibbs(m, x0[i], y0[i]))</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   X[i,] &lt;- XY[1,]</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   Y[i,] &lt;- XY[2,]</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">#对X的边缘分布利用Gelman-Rubin方法观测收敛性</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">#计算检验统计量psi</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(psi))</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  psi[i,] <span class="ot">&lt;-</span> psi[i,] <span class="sc">/</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(psi))</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制psi</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(2, 2))</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:k)</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(psi[i, (burn+1):m], type=&quot;l&quot;, xlab=i, ylab=bquote(psi))</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制Rhat</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(1, 1))</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rhat &lt;- numeric(m)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for(j in (burn+1):m)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   rhat[j] &lt;- Gelman.Rubin(psi[,1:j])</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(rhat[(burn+1):m], type=&quot;l&quot;, xlab=&quot;&quot;, ylab=&quot;R&quot;)</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(h=1.2, lty=2)</span></span></code></pre></div>
<p>可以看到对于<span class="math inline">\(X\)</span>的边缘分布，<span class="math inline">\(\hat{R}\)</span>约在3100次迭代后收敛到目标值<span class="math inline">\(1.2\)</span>。</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #对Y的边缘分布利用Gelman-Rubin方法观测收敛性</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># #计算检验统计量psi</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># psi &lt;- t(apply(Y, 1, cumsum))</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:nrow(psi))</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   psi[i,] &lt;- psi[i,] / (1:ncol(psi))</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制psi</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(2, 2))</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:k)</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(psi[i, (burn+1):m], type=&quot;l&quot;, xlab=i, ylab=bquote(psi))</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #绘制Rhat</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(1, 1))</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rhat &lt;- numeric(m)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for(j in (burn+1):m)</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   rhat[j] &lt;- Gelman.Rubin(psi[,1:j])</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(rhat[(burn+1):m], type=&quot;l&quot;, xlab=&quot;&quot;, ylab=&quot;R&quot;)</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(h=1.2, lty=2)</span></span></code></pre></div>
<p>可以看到对于<span class="math inline">\(Y\)</span>的边缘分布，<span class="math inline">\(\hat{R}\)</span>约在2600次迭代后收敛到目标值<span class="math inline">\(1.2\)</span>。</p>
</div>
</div>
<div id="a-21003-2021-11-18" class="section level2">
<h2>A-21003-2021-11-18</h2>
</div>
<div id="question-7" class="section level2">
<h2>Question</h2>
<p>Exercises 11.3 and 11.5 (pages 353-354, Statistical Computing with R).</p>
<p>Suppose <span class="math inline">\(T_1, ...,T_n\)</span> are i.i.d. samples drawn from the exponential distribution with expectation <span class="math inline">\(\lambda\)</span>. Those values greater than <span class="math inline">\(\tau\)</span> are not observed due to right censorship, so that the observed values are <span class="math inline">\(Y_i=T_iI(T_i \leq \tau) + \tau I(T_i&gt;\tau),\quad i=1,...,n\)</span>. Suppose <span class="math inline">\(\tau = 1\)</span> and the observed <span class="math inline">\(Y_i\)</span> values are as follows: <span class="math display">\[0.54, 0.48, 0.33, 0.43, 1.00, 1.00, 0.91, 1.00, 0.21, 0.85\]</span> Use the E-M algorithm to estimate <span class="math inline">\(\lambda\)</span>, compare your result with the observed data MLE (note:<span class="math inline">\(Y_i\)</span> follows a mixture distribution).</p>
</div>
<div id="answer-7" class="section level2">
<h2>Answer</h2>
<div id="section-7" class="section level3">
<h3>11.3</h3>
<p>(a)首先计算该级数的第<span class="math inline">\(k\)</span>项，为防止<span class="math inline">\(k\)</span>过大时溢出利用先取对数再求指数的方式计算</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Termk <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k){</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">length</span>(a)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    (<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span>k <span class="sc">*</span> <span class="fu">gamma</span>((d<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">/</span> ((<span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>(<span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">lgamma</span>(k<span class="sc">+</span><span class="dv">1</span>) <span class="sc">-</span> k<span class="sc">*</span><span class="fu">log</span>(<span class="dv">2</span>) <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">log</span>(<span class="fu">norm</span>(a, <span class="at">type =</span> <span class="st">&quot;2&quot;</span>)) <span class="sc">+</span> <span class="fu">lgamma</span>(k<span class="sc">+</span><span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">-</span> <span class="fu">lgamma</span>(k<span class="sc">+</span>d<span class="sc">/</span><span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>(b)进一步利用向量化运算求和</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>SumTerm <span class="ot">&lt;-</span> <span class="cf">function</span>(a){</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">200</span>)<span class="co">#求和至k=200</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">Termk</span>(a, K)))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>(c)当<span class="math inline">\(a=(1, 2)^T\)</span>时级数和</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">SumTerm</span>(a)</span></code></pre></div>
<pre><code>## [1] 1.532164</code></pre>
<p>结果约为1.53。</p>
</div>
<div id="section-8" class="section level3">
<h3>11.5</h3>
<p>首先求解Exercise 11.5</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ck <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k){</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>((a<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>k) <span class="sc">/</span> (k<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>a<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>}<span class="co">#积分限</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(u, k){</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">+</span> u<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)<span class="sc">^</span>(<span class="sc">-</span>(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>}<span class="co">#被积函数</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>intg <span class="ot">&lt;-</span> <span class="cf">function</span>(ck, k){</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">integrate</span>(g, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> ck, </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">k =</span> k)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>}<span class="co">#积分项</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>bk <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span><span class="sc">/</span><span class="fu">sqrt</span>(pi<span class="sc">*</span>k)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">lgamma</span>((k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">-</span> <span class="fu">lgamma</span>(k<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>}<span class="co">#常数项</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k){</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bk</span>(k)<span class="sc">*</span><span class="fu">intg</span>(<span class="fu">ck</span>(a, k), k)<span class="sc">$</span>value <span class="sc">-</span> <span class="fu">bk</span>(k<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">intg</span>(<span class="fu">ck</span>(a, k<span class="dv">-1</span>), k<span class="dv">-1</span>)<span class="sc">$</span>value</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>}<span class="co">#转化为求f(a ,k)=0</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="co">#求根</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps<span class="sc">^</span><span class="fl">0.25</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>root_115 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uniroot</span>(f, <span class="at">interval =</span> <span class="fu">c</span>(eps, <span class="dv">2</span>), <span class="at">k=</span>k)<span class="sc">$</span>root</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>计算Exercise 11.4中的<span class="math inline">\(A(k)\)</span></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="cf">function</span>(a,k){</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pt</span>(<span class="at">q=</span><span class="fu">sqrt</span>(a<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>k <span class="sc">/</span> (k<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>a<span class="sc">^</span><span class="dv">2</span>)), <span class="at">df=</span>k, <span class="at">lower.tail =</span> F)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>obj <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k){</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">S</span>(a, k) <span class="sc">-</span> <span class="fu">S</span>(a, k<span class="dv">-1</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>root_114 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uniroot</span>(obj, <span class="at">interval =</span> <span class="fu">c</span>(eps, <span class="dv">2</span>), <span class="at">k=</span>k)<span class="sc">$</span>root</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>取<span class="math inline">\(k=4:25, 100, 500, 1000\)</span>对比二者的解</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">25</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(ks), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>result[,<span class="dv">1</span>] <span class="ot">&lt;-</span> ks</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ks)){</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  result[i, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">root_115</span>(ks[i]), <span class="fu">root_114</span>(ks[i]))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(result)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;k&quot;</span>, <span class="st">&quot;ex11.5&quot;</span>, <span class="st">&quot;ex11.4&quot;</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result, <span class="at">caption =</span> <span class="st">&quot;表2.1：ex11.5与ex11.4求根结果对比&quot;</span>)</span></code></pre></div>
<table>
<caption>表2.1：ex11.5与ex11.4求根结果对比</caption>
<thead>
<tr class="header">
<th align="right">k</th>
<th align="right">ex11.5</th>
<th align="right">ex11.4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4</td>
<td align="right">1.492103</td>
<td align="right">1.492103</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1.533556</td>
<td align="right">1.533556</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">1.562744</td>
<td align="right">1.562744</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">1.584430</td>
<td align="right">1.584430</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">1.601185</td>
<td align="right">1.601185</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">1.614521</td>
<td align="right">1.614521</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">1.625390</td>
<td align="right">1.625390</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">1.634419</td>
<td align="right">1.634419</td>
</tr>
<tr class="odd">
<td align="right">12</td>
<td align="right">1.642038</td>
<td align="right">1.642038</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">1.648554</td>
<td align="right">1.648554</td>
</tr>
<tr class="odd">
<td align="right">14</td>
<td align="right">1.654190</td>
<td align="right">1.654190</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">1.659114</td>
<td align="right">1.659114</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">1.663452</td>
<td align="right">1.663452</td>
</tr>
<tr class="even">
<td align="right">17</td>
<td align="right">1.667304</td>
<td align="right">1.667304</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="right">1.670745</td>
<td align="right">1.670745</td>
</tr>
<tr class="even">
<td align="right">19</td>
<td align="right">1.673840</td>
<td align="right">1.673840</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">1.676637</td>
<td align="right">1.676637</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">1.679178</td>
<td align="right">1.679178</td>
</tr>
<tr class="odd">
<td align="right">22</td>
<td align="right">1.681496</td>
<td align="right">1.681496</td>
</tr>
<tr class="even">
<td align="right">23</td>
<td align="right">1.683620</td>
<td align="right">1.683620</td>
</tr>
<tr class="odd">
<td align="right">24</td>
<td align="right">1.685572</td>
<td align="right">1.685572</td>
</tr>
<tr class="even">
<td align="right">25</td>
<td align="right">1.687373</td>
<td align="right">1.687373</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">1.720608</td>
<td align="right">1.720608</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="right">1.729756</td>
<td align="right">1.729755</td>
</tr>
<tr class="odd">
<td align="right">1000</td>
<td align="right">1.730907</td>
<td align="right">1.730908</td>
</tr>
</tbody>
</table>
<p>从表2.1可以看到，二者求解结果是一致的。</p>
</div>
<div id="discussion-2" class="section level3">
<h3>Discussion</h3>
<p>Suppose <span class="math inline">\(T_1, ...,T_n\)</span> are i.i.d. samples drawn from the exponential distribution with expectation <span class="math inline">\(\lambda\)</span>. Those values greater than <span class="math inline">\(\tau\)</span> are not observed due to right censorship, so that the observed values are <span class="math inline">\(Y_i=T_iI(T_i \leq \tau) + \tau I(T_i&gt;\tau),\quad i=1,...,n\)</span>. Suppose <span class="math inline">\(\tau = 1\)</span> and the observed <span class="math inline">\(Y_i\)</span> values are as follows: <span class="math display">\[0.54, 0.48, 0.33, 0.43, 1.00, 1.00, 0.91, 1.00, 0.21, 0.85\]</span> Use the E-M algorithm to estimate <span class="math inline">\(\lambda\)</span>, compare your result with the observed data MLE (note:<span class="math inline">\(Y_i\)</span> follows a mixture distribution).</p>
<p><strong>solution:</strong> We know that <span class="math inline">\(Y_i=T_iI(T_i \leq \tau) + \tau I(T_i&gt;\tau)\)</span>在<span class="math inline">\(\tau\)</span>follows a mixture distribution. When <span class="math inline">\(T_i \leq \tau\)</span>, <span class="math inline">\(Y_i \sim \operatorname{Exp}(\frac{1}{\lambda})\)</span>, when<span class="math inline">\(T_i&gt;\tau\)</span>, <span class="math inline">\(Y_i=\tau\)</span>and <span class="math inline">\(P(Y_i=\tau)=e^{-\frac{\tau}{\lambda}}\)</span>, denote <span class="math inline">\(n_{\tau}\)</span> the number of those values greater than <span class="math inline">\(\tau\)</span>, then the observed data likelihood can be expressed as <span class="math display">\[L(\lambda|n_{\tau})=\prod_{i=1}^{n-n_{\tau}} \frac{1}{\lambda} e^ {-\frac{y_i}{\lambda}}\prod_{i=1}^{n_{\tau}}e^{-\frac{\tau}{\lambda}}=\frac{1}{\lambda^{n-n_\tau}}e^{-\frac{\sum_{i=1}^{n} y_i}{\lambda}},\]</span> so the MLE for observed data is<span class="math inline">\(\frac{\sum_{i=1}^{n} y_i}{n-n_\tau}\)</span>. Complete data likelihood is <span class="math display">\[L(\lambda|\mathbf{y})=\prod_{i=1}^{n} \frac{1}{\lambda} \exp \left(-y_{i} / \lambda\right)\]</span> Denote <span class="math inline">\(\delta_i=1\)</span>if <span class="math inline">\(y_i \leq \tau\)</span> and <span class="math inline">\(\delta_i=0\)</span> if <span class="math inline">\(y_i\)</span> is censored at <span class="math inline">\(\tau\)</span>. For the censored data, denote the complete data is <span class="math inline">\(t_i\)</span>. The E-step is <span class="math display">\[\mathbb{E}_{\hat{\lambda}_0}\left[L(\lambda|\mathbf{y}) \mid \delta_i \right]=\mathbb{E}_{\hat{\lambda}_0}\left\{-n \log \lambda-\frac{1}{\lambda}\left[\sum_{i=1}^{n} \delta_{i} y_{i}+\left(1-\delta_{i}\right) t_{i}\right] \mid \delta_i\right\}\]</span> Use the memoryless property of the exponential distribution, we can get <span class="math inline">\(\mathbb{E}_{\hat{\lambda}_0}\left[t_i \mid \delta_i \right]=\tau + \hat{\lambda}_0\)</span>, so for the E-step we have <span class="math display">\[\mathbb{E}_{\hat{\lambda}_0}\left[L(\lambda|\mathbf{y}) \mid \delta_i \right]=-n \log \lambda-\frac{1}{\lambda}\left[\sum_{i=1}^{n} \delta_{i} y_{i}+\left(1-\delta_{i}\right) (\tau + \hat{\lambda}_0)\right],\]</span> maximize the above function to execute the M-step <span class="math display">\[\hat{\lambda}_1=\frac{1}{n}\left[\sum_{i=1}^{n} \delta_{i} y_{i}+\left(1-\delta_{i}\right) (\tau + \hat{\lambda}_0)\right]=\frac{1}{n}\left[\sum_{i=1}^{n}y_i+n_{\tau}\hat{\lambda}_0\right],\]</span> The converged <span class="math inline">\(\lambda\)</span> estimate is the solution of the following equation <span class="math display">\[\lambda=\frac{1}{n}\left[\sum_{i=1}^{n}y_i+n_{\tau}\lambda\right] \Rightarrow \lambda=\frac{\sum_{i=1}^{n}y_i}{n-n_\tau}\]</span> which is the same as the observed data MLE.</p>
<p>Use EM algorithm to solve MLE of <span class="math inline">\(\lambda\)</span>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.54</span>, <span class="fl">0.48</span>, <span class="fl">0.33</span>, <span class="fl">0.43</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">0.91</span>, <span class="fl">1.00</span>, <span class="fl">0.21</span>, <span class="fl">0.85</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>lambda0 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>EMlambda <span class="ot">&lt;-</span> <span class="cf">function</span>(y, lambda){</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  tol <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  nt <span class="ot">&lt;-</span> <span class="fu">sum</span>(y<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    total <span class="ot">&lt;-</span> <span class="fu">sum</span>(y)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    lambda_old <span class="ot">&lt;-</span> lambda</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> (total <span class="sc">+</span> nt<span class="sc">*</span>lambda_old) <span class="sc">/</span> n</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">abs</span>(lambda <span class="sc">-</span> lambda_old)<span class="sc">/</span>lambda_old <span class="sc">&lt;</span>tol) <span class="cf">break</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lambda)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="fu">EMlambda</span>(y, lambda0)</span></code></pre></div>
<pre><code>## [1] 0.9642857</code></pre>
<p>Using EM algorithm we get the estimation of <span class="math inline">\(\lambda\)</span> is about 0.964.</p>
</div>
</div>
<div id="a-21003-2021-11-25" class="section level2">
<h2>A-21003-2021-11-25</h2>
</div>
<div id="question-8" class="section level2">
<h2>Question</h2>
<p>Exercises 1 and 5 (page 204, Advanced R)</p>
<p>Exercises 1 and 7 (page 214, Advanced R)</p>
</div>
<div id="answer-8" class="section level2">
<h2>Answer</h2>
<div id="section-9" class="section level3">
<h3>1.1</h3>
<p>在第一个<code>lapply</code>语句中<code>trims</code>的每个元素被显式地传递给了<code>mean</code>函数的第二个参数。而在第二个<code>lapply</code>语句中，<code>mean</code>函数的第一个参数经由位置匹配把<code>lapply</code>的第三个参数传给了它。二者得到结果实际是等价的。</p>
</div>
<div id="section-10" class="section level3">
<h3>1.5</h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>rsq <span class="ot">&lt;-</span> <span class="cf">function</span>(mod) <span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared</span></code></pre></div>
<ul>
<li>对ex3中的模型</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>formulas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  mpg <span class="sc">~</span> disp,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  mpg <span class="sc">~</span> disp <span class="sc">+</span> wt,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp) <span class="sc">+</span> wt</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulas, lm, <span class="at">data =</span> mtcars)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(fit3, rsq)</span></code></pre></div>
<pre><code>## [1] 0.7183433 0.8596865 0.7809306 0.8838038</code></pre>
<ul>
<li>对ex4中的模型</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>bootstraps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(i) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="at">rep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  mtcars[rows, ]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(bootstraps, lm, <span class="at">formula =</span> mpg <span class="sc">~</span> disp)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(fit4, rsq)</span></code></pre></div>
<pre><code>##  [1] 0.7638473 0.7123009 0.8170350 0.6959773 0.7829012 0.8556576 0.7695607
##  [8] 0.6496155 0.7713120 0.6990634</code></pre>
</div>
<div id="section-11" class="section level3">
<h3>2.1</h3>
<p>(a)对数值型数据框</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">nrow =</span> <span class="dv">3</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(dt, sd, <span class="fu">numeric</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## V1 V2 V3 
##  1  1  1</code></pre>
<p>(b)对混合型数据框，通过嵌套使用<code>vapply</code>两次</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#以iris数据集为例</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(iris[<span class="fu">vapply</span>(iris, is.numeric, <span class="fu">logical</span>(<span class="dv">1</span>))], sd, <span class="fu">numeric</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
##    0.8280661    0.4358663    1.7652982    0.7622377</code></pre>
</div>
<div id="section-12" class="section level3">
<h3>2.7</h3>
<ul>
<li>实现<code>sapply()</code>的多核版本<code>mcsapply()</code></li>
</ul>
<p>参照R中<code>sapply()</code>利用<code>lapply()</code>实现的方法，类似地可以实现<code>mcsapply()</code></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(parallel)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cores &lt;-  detectCores()</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>mcsapply <span class="ot">&lt;-</span> <span class="cf">function</span>(X, FUN, ..., <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>){</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  FUN <span class="ot">&lt;-</span> <span class="fu">match.fun</span>(FUN)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  answer <span class="ot">&lt;-</span> <span class="fu">mclapply</span>(<span class="at">X =</span> X, <span class="at">FUN =</span> FUN, ...)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (USE.NAMES <span class="sc">&amp;&amp;</span> <span class="fu">is.character</span>(X) <span class="sc">&amp;&amp;</span> <span class="fu">is.null</span>(<span class="fu">names</span>(answer)))</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(answer) <span class="ot">&lt;-</span> X</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">identical</span>(simplify, <span class="cn">FALSE</span>) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(answer))</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">simplify2array</span>(answer, <span class="at">higher =</span> (simplify <span class="sc">==</span> <span class="st">&quot;array&quot;</span>))</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> answer</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>而由于<code>vapply()</code>并未基于<code>lapply()</code>，因此难以实现它的并行版本<code>mcvapply()</code>。</p>
</div>
</div>
<div id="a-21003-2021-12-02" class="section level2">
<h2>A-21003-2021-12-02</h2>
</div>
<div id="question-9" class="section level2">
<h2>Question</h2>
<p>Write an Rcpp function for Exercise 9.8 (page 278, Statistical Computing with R).</p>
</div>
<div id="answer-9" class="section level2">
<h2>Answer</h2>
<p>由题知该二元密度<span class="math inline">\(f(x,y),\quad x=0,1,...,n,0\leq y\leq 1\)</span>的条件分布分别为<span class="math inline">\(Binomial(n,y)\)</span>和<span class="math inline">\(Beta(x+a, n-x+b)\)</span>。利用Gibbs sampler生成该二元密度的随机数</p>
<ul>
<li>R function</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gibbs sampler function, 固定n=10, a=1, b=2</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#R function for ex9.8</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>gibbsR <span class="ot">&lt;-</span> <span class="cf">function</span>(N, x0, y0, <span class="at">n=</span><span class="dv">10</span>, <span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">2</span>){</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> N, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#初始化</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x0</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y0</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  X[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N){</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> X[i<span class="dv">-1</span>, <span class="dv">2</span>]</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    X[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, y)<span class="co">#x|y为Binomial(n,y)</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> X[i, <span class="dv">1</span>]</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    X[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x<span class="sc">+</span>a, n<span class="sc">-</span>x<span class="sc">+</span>b)<span class="co">#y|x为Beta(x+a, n-x+b)</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(X)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Cpp function</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cpp function for ex9.8</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;NumericMatrix gibbsC(int N, double x0, double y0, int n=10, int a=1, int b=2){</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="st">  NumericMatrix mat(N, 2);</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="st">  double x = x0, y = y0;</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="st">  mat(0, 0) = x;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="st">  mat(0, 1) = y;</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="st">  for(int i = 1; i &lt; N; i++){</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="st">    y = mat(i-1, 1);</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="st">    mat(i, 0) = rbinom(1, n, y)[0];</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="st">    x = mat(i, 0);</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="st">    mat(i, 1) = rbeta(1, x+a, n-x+b)[0];</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="st">  return mat;</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span>)</span></code></pre></div>
<ul>
<li>Compare the corresponding generated random numbers with pure R language using the function <code>qqplot</code>.</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1198</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co">#初始化</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fl">0.5</span><span class="sc">*</span>n</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> (x0<span class="sc">+</span>a) <span class="sc">/</span> (n<span class="sc">+</span>a<span class="sc">+</span>b)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>Chain_R <span class="ot">&lt;-</span> <span class="fu">gibbsR</span>(N, x0, y0)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>Chain_Cpp <span class="ot">&lt;-</span> <span class="fu">gibbsC</span>(N, x0, y0)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="do">##qqplot compare for x</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>x_R <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Chain_R[(burn<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>N,<span class="dv">1</span>])</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>x_Cpp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Chain_Cpp[(burn<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>N,<span class="dv">1</span>])</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ppoints</span>(<span class="dv">100</span>)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="fu">quantile</span>(x_R, p), <span class="fu">quantile</span>(x_Cpp, p), <span class="at">xlab =</span> <span class="st">&quot;R&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rcpp&quot;</span>)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="do">##qqplot compare for y</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>y_R <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Chain_R[(burn<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>N,<span class="dv">2</span>])</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>y_Cpp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Chain_Cpp[(burn<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>N,<span class="dv">2</span>])</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="fu">quantile</span>(y_R, p), <span class="fu">quantile</span>(y_Cpp, p), <span class="at">xlab =</span> <span class="st">&quot;R&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rcpp&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<ul>
<li>Campare the computation time of the two functions with the function <code>microbenchmark</code>.</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="at">gR=</span><span class="fu">gibbsR</span>(N, x0, y0), <span class="at">gC=</span><span class="fu">gibbsC</span>(N, x0, y0))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ts)[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>)]</span></code></pre></div>
<pre><code>##   expr       lq   median       uq
## 1   gR 19.38455 25.49945 27.02745
## 2   gC  1.32735  1.34045  1.40690</code></pre>
<p>结论：(1)从qq图可以看到，利用R和Rcpp生成的随机数x, y分布相同。(2)从计算时间来看，利用Rcpp生成随机数的速度更快。</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
